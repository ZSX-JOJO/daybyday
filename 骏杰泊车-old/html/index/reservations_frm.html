<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
<meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
<title>Hello APP</title>
<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
<link rel="stylesheet" type="text/css" href="../../css/common.css" />
<style>
	body {
		background: #f6f8fa;
	}
	.info {
		background: #fff;
		padding: 0 0.75rem;
	}
	.aui-info {
		height: 2.5rem;
	}
	.info .aui-info-item img.arrowRight {
		height: 0.5rem;
		display: block;
	}
	.aui-card-list-footer {
		height: 2.35rem;
		line-height: 2.35rem;
		padding-top: 0;
		padding-bottom: 0;
		background: #fff;
	}
	.aui-card-list-footer img.img-icon {
		display: inline-block !important;
		width: auto !important;
		height: 0.75rem !important;
		position: relative;
		top: 2px;
		margin-right: 0.2rem;
	}
	.footerBtn {
		padding: 0 0.75rem;
		margin: 3rem 0 1rem;
	}
	.footerBtn .aui-bar {
		border-radius: 1.5rem;
		box-shadow: 0 0.2rem 0.2rem rgba(0,0,0,0.15);
	}
	.footerBtn .aui-bar-btn-item {
		border: none;
		background: #B7B7B7;
		width: 50%;
		color: #fff;
		font-size: 0.75rem;
		line-height: 2.25rem;
	}
	.footerBtn .aui-active {
		background: #083a91;
	}
	.aui-margin-b-5 {
		margin-bottom: 0.2rem !important;
	}
	.aui-card-list {
		margin-bottom: 0;
	}
	.padding-t-b {
		padding-top: 0.6rem;
		padding-bottom: 0.25rem;
	}
	@media all and (max-width:350px){
		.fontHide {
			display: none;
		}
	}
</style>
</head>

<body>
<section class="aui-content">
	<div>
		<div class="aui-font-size-12 aui-text-center padding-t-b">选择接车时间</div>
		<div class="aui-info info text-dark" tapmode onClick="selectDate();">
			<div class="aui-info-item font-size-15"><span class="fontHide">请选择</span>预计抵达停车场时间</div>
			<div class="aui-info-item right-arrow aui-padded-r-15" id="date_time"></div>
		</div>
	</div>
	<div>
		<div class="aui-font-size-12 aui-text-center padding-t-b">联系人信息</div>
		<div class="aui-info info text-dark">
			<div class="aui-info-item font-size-15">联系人姓名</div>
			<div class="aui-info-item">
				<input type="text" class="aui-font-size-12 aui-text-right" placeholder="请填写真实姓名" id="contact-name">
			</div>
		</div>
	</div>
	<div>
		<div class="aui-font-size-12 aui-text-center padding-t-b">车辆信息</div>
		<div class="aui-card-list" tapmode onClick="openCar();">
			<div class="aui-card-list-footer">
				<div></div>
				<div id="car-wrap"> <img src="../../image/index/53.png" class="img-icon" /> <span class="font-size-15 text-dark">添加车辆信息</span> </div>
				<div></div>
			</div>
		</div>
	</div>
	<div id="other-srv-wrap">

	</div>
	<script type="text/x-dot-tpl" id="other-srv-tpl">
		<div class="aui-font-size-12 aui-text-center padding-t-b">其他服务</div>
		{{for(var i in it){}}
		{{? it[i].item_price_type == "1"}}
		<div class="info" tapmode onClick="selectOil({{=it[i].item_id}},'{{=it[i].item_name}}');" id="item-{{=it[i].item_id}}"  data-name="{{=it[i].item_name}}">
		{{?? it[i].item_price_type == "2"}}
		<div class="info" tapmode onClick="selectItem('carwash_win',{{=it[i].item_id}},'{{=it[i].item_name}}');" id="item-{{=it[i].item_id}}" data-name="{{=it[i].item_name}}">
		{{?}}
			<div class="aui-info text-dark aui-border-b right-arrow aui-padded-r-15">
				<div class="aui-info-item font-size-15">{{=it[i].item_name}}</div>
				<div class="aui-info-item aui-font-size-14 oil_data" data-name="{{=it[i].item_name}}"></div>
			</div>
		</div>
		{{ }}}
	</script>
	<div class="footerBtn">
		<div class="aui-bar aui-bar-btn aui-bar-btn-round">
			<div class="aui-bar-btn-item" tapmode onclick="charge_win('charge_win');">不确定何时回程</div>
			<div class="aui-bar-btn-item aui-active" tapmode onclick="openReturnAirport();">填写回程信息</div>
		</div>
	</div>
</section>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/dom7.js"></script>
<script type="text/javascript" src="../../script/dot.min.js"></script>
<script type="text/javascript">
	var park_id;
	var pageData;
	var carId;
    apiready = function() {
    	api.parseTapmode();
		pageData = api.pageParam;
		park_id = api.pageParam.park_id;
		// console.log(JSON.stringify(api.pageParam))
		loadParkData();
    };
	function loadParkData(){
		var postData = {};
		postData.park_id = park_id;
		api.ajax({
		    url: BASE_URL + 'App/Parking/parkDetail',
		    method: 'post',
		    data: {
		        values: postData
		    }
		},function(ret, err){
		    if (ret) {
		        if(ret.code == 1){
					if(ret.srv){
						var srvTpl = document.getElementById("other-srv-tpl").innerHTML;
						var srvFn = doT.template(srvTpl);
						document.getElementById("other-srv-wrap").innerHTML = srvFn(ret.srv);
						api.parseTapmode();
					}
				}
		    }
		});
	}
	function selectDate(){
		api.openFrame({
			name: 'date_mask',
			url: 'date_mask.html',
			rect: {
				x: 0,
				y: 0,
				w: 'auto',
				h: 'auto'
			},
			pageParam: {
				wname: api.winName,
				fname: api.frameName,
			}
		});
	}
	//修改项目
	function selectOil(itemId,itemName){
		api.openFrame({
			name: 'oil_mask',
			url: 'oil_mask.html',
			rect: {
				x: 0,
				y: 0,
				w: 'auto',
				h: 'auto'
			},
			pageParam: {
				item_id:itemId,
				item_name:itemName,
				wname: api.winName,
				fname: api.frameName
			}
		});
	}
	function selectItem(url,itemId,itemName){
		api.openWin({
			name: url,
			url: url + '.html',
			slidBackEnabled:false,
			pageParam: {
				item_id:itemId,
				item_name:itemName,
				wname: api.winName,
				fname: api.frameName
			}
		});
	}
	//车辆信息
	function openCar(){
		api.openWin({
			name: 'common_car_win',
			url: '../mine/common_car_win.html',
			pageParam:{
				source:'order',
				wname:api.winName,
				fname:api.frameName
			}
		});
	}
	function changeCarData(carNum,_carId){
		// alert(carNum)
		carId = _carId;
		// alert(carId)
		document.getElementById("car-wrap").textContent = carNum;
	}
	function changeData(domId,text){
		document.getElementById(domId).textContent = text;
	}
	//返回数据更改
	function changeSrvData(domId,srvName,srvAmount,itemId){
		$$('#item-'+itemId+' .oil_data').text(srvName+srvAmount+"元");
		$$('#item-'+itemId+' .oil_data').attr("srv-name",srvName);
		$$('#item-'+itemId+' .oil_data').attr("srv-amount",srvAmount);
	}
	var oilTxt,oilPrice;
	function getOil(txt,price,itemId){
		oilTxt = txt;
		oilPrice = price;
		$$('#item-'+itemId+' .oil_data').text(txt + price+"元");
		$$('#item-'+itemId+' .oil_data').attr("srv-name",txt);
		$$('#item-'+itemId+' .oil_data').attr("srv-amount",price);
	}
	function charge_win(url){
		var data_pick_time = document.getElementById("date_time").textContent;//抵达停车场时间
		var contactName = document.getElementById("contact-name").value;//联系人姓名
		pageData.returnType = 1;//不确定何时回程
		// pageData.date
		pageData.data_username = contactName;
		pageData.data_pick_time = data_pick_time;
		pageData.car_id = carId;
		var srvDoms = document.querySelectorAll('[srv-name]');
		var srvData = new Array();
		if(srvDoms.length){
			for(var i = 0; i<srvDoms.length;i++){
				srvData[i] = {};
				srvData[i].name = srvDoms[i].getAttribute('data-name')+"-"+srvDoms[i].getAttribute('srv-name');
				srvData[i].amount = srvDoms[i].getAttribute('srv-amount');
			}
		}
		if(srvData.length){
			pageData.srv = srvData;
		}
		// console.log(JSON.stringify(pageData));return;
		// 获取其他服务
		api.openWin({
		    name: url,
		    url: url + '.html',
		    pageParam: pageData
		});
	}
	function openReturnAirport(url){
		var data_pick_time = document.getElementById("date_time").textContent;//抵达停车场时间
		var contactName = document.getElementById("contact-name").value;//联系人姓名
		pageData.returnType = 2;//不确定何时回程
		// pageData.date
		pageData.data_username = contactName;
		pageData.data_pick_time = data_pick_time;
		pageData.car_id = carId;
		var srvDoms = document.querySelectorAll('[srv-name]');
		var srvData = new Array();
		if(srvDoms.length){
			for(var i = 0; i<srvDoms.length;i++){
				srvData[i] = {};
				srvData[i].name = srvDoms[i].getAttribute('data-name')+"-"+srvDoms[i].getAttribute('srv-name');
				srvData[i].amount = srvDoms[i].getAttribute('srv-amount');
			}
		}
		if(srvData.length){
			pageData.srv = srvData;
		}
		api.openWin({
		    name: 'return_airport_win',
		    url: 'return_airport_win.html',
		    pageParam: pageData
		});
	}
	
</script>
</html>
