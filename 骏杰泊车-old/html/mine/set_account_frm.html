<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>Hello APP</title>
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui-flex.css" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css" />
    <script type="text/javascript" src="../../script/dot.min.js"></script>
    <style type="text/css">
    	body{
            background-color: #F6F8FA;
        }
        .pay-style{
        	width: 0.75rem;
			margin-right: 0.5rem;
        }
        .aui-switch{
            /*width: 2.2rem;*/
            /*height: 1.15rem;*/
            /*border-radius:0.575rem;*/
        }
        .aui-switch:checked{
            /*width: 2.2rem;*/
            /*height: 1.15rem;*/
            background-color:#0071C5;
            border-color:#0071C5;
        }
        .aui-switch:checked:before{
            /*width: 1rem;
            height: 1rem;
            left:1.1rem;*/
        }
        /*重写*/
        .sec{
            margin-top:0.3rem;
            background-color: #FFF;
            padding: 0 0.75rem;
            font-size:0.75rem;
        }
        .list{
            height:2.5rem;
        }
        .left{

        }
        .right{
            color:#999999;
            font-size:0.7rem;
            /*padding-right:0.4rem;*/
        }
    </style>
</head>
<body>
    <div id="doT-Html"></div>
    <script type="text/x-dot-template" id="doT-Template">
    <div class="content">
        <div class="sec">
            <div class="list aui-border-b aui-flex-col aui-flex-middle aui-flex-between right-arrow aui-padded-r-10" tapmode onclick="openWin('fix_phone_win')">
                <div class="left">修改手机号</div>
                <div class="right">{{=it.data.user_mobile}}</div>
            </div>
            <div class="list aui-border-b aui-flex-col aui-flex-middle aui-flex-between right-arrow" tapmode onclick="openWin('fix_pass_win')">
                <div class="left">修改密码</div>
                <div class="right"></div>
            </div>
            <div class="list aui-flex-col aui-flex-middle aui-flex-between right-arrow aui-padded-r-15" tapmode onclick="openMail(this)">
                <div class="left">邮箱</div>
                <div class="right" id="email">{{=it.data.user_email||''}}</div>
            </div>
        </div>
        <div class="sec">
            <div class="list aui-border-b aui-flex-col aui-flex-middle aui-flex-between">
                <div class="left">
                    <div class="aui-flex-col aui-flex-middle aui-flex-between">
                        <img src="../../image/index/61.png" class="pay-style">
                        <div>微信</div>
                    </div>
                </div>
                <dir class="right">
                    <input type="checkbox" class="aui-switch" checked>
                </dir>
            </div>
            <div class="list aui-flex-col aui-flex-middle aui-flex-between">
                <div class="left">
                    <div class="aui-flex-col aui-flex-middle aui-flex-between">
                        <img src="../../image/index/62.png" class="pay-style">
                        <div>支付宝</div>
                    </div>
                </div>
                <dir class="right">
                    <input type="checkbox" class="aui-switch">
                </dir>
            </div>
        </div>
    </div>
    </script>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/dom7.js"></script>
<script type="text/javascript">

    var userid;
    var text_new;
    var postData;
    apiready = function(){
        api.parseTapmode();
        userid = $api.getStorage('userid');
        loadPage();
    };
    function openWin(url){
        api.openWin({
            name: url,
            url: url + '.html'
        });
    }
    function loadPage(){
        postData = {};
    	postData.userid = userid;
    	api.ajax({
    	    url: BASE_URL + 'App/Mine/userInfo',
    	    method: 'post',
    	    data: {
    	        values:postData
    	    }
    	}, function(ret, err) {
    	    if (ret) {
				//console.log(JSON.stringify(ret));
    	        if(ret.code == "1"){
    	        	document.querySelector("#doT-Html").innerHTML = doT.template(document.querySelector("#doT-Template").innerHTML)(ret);
    	        }
    	    }
    	});
    }
    // 修改邮箱
    function openMail(n){
        var _this = n;
        var text = $$('#email').text();
        api.prompt({
            title: '邮箱',
            msg: '',
            text: text,
            buttons: ['确定', '取消']
        }, function(ret, err) {
            var index = ret.buttonIndex;
            text_new = ret.text;
            if(index == 1){
                etitMail()//修改邮箱
            }
        });
    }
    // 修改邮箱
    function etitMail(){
        postData = {};
        postData.userid = userid;
        postData.email = text_new;
        api.ajax({
            url: BASE_URL + 'App/Mine/editEmail',
            method: 'post',
            data: {
                values:postData
            }
        }, function(ret, err) {
            if (ret) {
                if(ret.code == "1"){
                    api.toast({
                        msg: '修改成功',
                        duration: 1000,
                        location: 'middle'
                    });
                    $$('#email').text(text_new);
                    // 重新获取本页面数据

                }else if(ret.code == "-1"){
                    api.toast({
                        msg: '修改失败',
                        duration: 1000,
                        location: 'middle'
                    });
                }
            }
        });
    }
</script>
</html>
