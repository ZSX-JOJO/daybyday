<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
<title>Hello APP</title>
<link rel="stylesheet" type="text/css" href="../../css/aui-flex.css" />
<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
<link rel="stylesheet" type="text/css" href="../../css/common.css" />
<script type="text/javascript" src="../../script/dot.min.js"></script>
<style>
	.addCar {
		margin-top: 0.3rem;
		height: 2.5rem;
		background: #FFF;
	}
	.addCar .ico {
		margin-right: 0.35rem;
		width: 0.75rem;
	}
	.carList .item {
		margin-top: 0.35rem;
		padding: 0.5rem 1.25rem 0.5rem 0.75rem;
		background-color: #FFF;
		font-size: 0.75rem;
		line-height: 1.35rem;
		color: #333;
	}
	.carList .item .check {
		width: 1.4rem;
		height: 3rem;
		background: url(../../image/common/41.png) no-repeat center center;
		background-size: 0.9rem auto;
	}
	.carList .item .check.checked {
		background: url(../../image/common/40.png) no-repeat center center;
		background-size: 0.9rem auto;
	}
	.carList .item .flex-auto {
		padding-left: 0.75rem;
	}
	.carList .item .info {
		margin-left: 0.5rem;
	}
	.carList .item .editBtn {
		margin-left: auto;
	}
	.carList .item .editBtn img {
		width: 1.1rem;
	}
</style>
</head>

<body>
<div class="aui-content">
	 <div class="addCar aui-flex-col aui-flex-middle aui-flex-center" tapmode onclick="editCar();">
	 	<div class="ico"><img src="../../image/index/53.png" alt=""></div>
	 	<div class="font-size-15 text-dark">添加车辆</div>
	 </div>
	 <div id="doT-Html"></div>
	<script type="text/x-dot-template" id="doT-Template">
	<div class="carList">
	 {{for(var i in it){}}
	 	<div class="item aui-flex-col aui-flex-middle">
	 		<div class="check" tapmode onClick="check(this);" data-carnum="{{=it[i].car_number_plate}}" data-carid="{{=it[i].car_id}}"></div>
	 		<div class="flex-auto">
	 			<div>车牌号:<span class="info car_num">{{=it[i].car_number_plate || ''}}</span></div>
	 			<div>颜色: <span class="info car_color">{{=it[i].car_color || ''}}</span></div>
	 			<div>车型: <span class="info car_type">{{=it[i].car_model || ''}}</span></div>
	 		</div>
	 		<div class="editBtn" tapmode onclick="editCar({{=it[i].car_id}});"><img src="../../image/mine/edit.png" alt=""></div>
	 	</div>
	 {{}}}
  	</div>
	 </script>
</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/dom7.js"></script>
<script type="text/javascript">
	var userid;
	var source;
    apiready = function() {
		// 判断打开窗口来源，主要用于下单页面
		if(api.pageParam.source){
			source = api.pageParam.source;
		}
        api.parseTapmode();
        userid = $api.getStorage('userid');
        commonCar();
        api.addEventListener({//添加车辆成功后
            name: 'addSuccess'
        }, function(ret, err) {
            if (ret) {
            	commonCar();
            }
        });
    };
	function check(n){
		$$('.item .check').removeClass('checked');
		$$(n).addClass('checked');
		if(source && source == 'order'){
			var carNum = n.getAttribute("data-carnum");
			var carId = n.getAttribute("data-carid");
			var jsfun = 'changeCarData("'+ carNum +'","'+carId+'")';
			api.execScript({
				name: api.pageParam.wname,
				frameName: api.pageParam.fname,
				script: jsfun
			});
			api.closeWin({
			});
		}


	}
    function editCar(carId) {
		api.openWin({
			name: 'edit_car_info_win',
			url: 'edit_car_info_win.html',
			pageParam: {
				carId: carId
			}
		});
    }
    function commonCar(){
    	postData = {};
    	postData.userid = userid;
    	api.ajax({
    	    url: BASE_URL + 'App/Mine/userCar',
    	    method: 'post',
    	    data: {
    	        values:postData
    	    }
    	}, function(ret, err) {
    	    if (ret) {
				//console.log(JSON.stringify(ret));
    	        if(ret.code == "1"){
    	        	document.getElementById("doT-Html").innerHTML = doT.template(document.getElementById("doT-Template").innerHTML)(ret.data);
    	        }
    	    }
    	});
    }
</script>
</html>
