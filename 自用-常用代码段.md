# 1：ajax

### 	1.1：APIclod： 

### 	api.ajax：跨域异步请求，支持文件上传

```
api.ajax({
    url: 'http://192.168.1.101:3101/upLoad', //(路径)后台接口地址
    method: 'post', //数据传输方式
    data: {
        values: {
            name: 'haha', //传入的参数，对应postman中的Body
            name: 'haha',
            其他参数
        },
    	headers:{'X-APICloud-AppKey':123456, //请求头 对应postman中的Headers
    		'X-APICloud-AppId':123456
    	}
    }
}, function(ret, err) {  //以下内容搭配dot模版(doT.js)，doT模版适用于页面中相同‘样式’的部分(列表)
ret正确数据（可自定义名称）,err错误数据（可自定义名称）
    if (ret) {
        //api.alert({ msg: JSON.stringify(ret) }); //将从后台得到的数据通过json格式'打印'出来
        var tpl = document.getElementById("tpl").innerHTML; //获取dot模版(将需要使用doT模版进行显示的部分设置id).
         var tempFn = doT.template(tpl); //解析模版(doT.template() dot解析方法 固定用法).[解析完成后赋值(解析的作用就是dot可以完成模板中的dot赋值)]   
         document.getElementById("list").innerHTML = tempFn(ret); //数据插入(将通过后台获得的数据插入到设置的模版地方)[将解析后的原模板(document.getElementById("tpl").innerHTML)插入数据(ret),然后插入list中]
        
    } else {
        //api.alert({ msg: JSON.stringify(err) });
    }
});
---------------------------------------------------------------------------------------------
<div id="list"></div> //模版存放位置(数据插入位置)
<script type="text/x-dot-template" id="tpl"> //dot模板(将需要使用doT模版的位置,使用固定用法进行包括)
<div>...</div> ... <div>...</div> //
</script>
---------------------------------------------------------------------------------------------
```

## 	DOT.JS: 持续更新中......

```
---------------------------------------------------------------------------------------------
{{=it}} //直接赋值(it就是指tempFn(ret)中的ret)
---------------------------------------------------------------------------------------------
{{? it}} //if判断
    {{? it == 1}}
    <div>等于1的div</div>
    {{?}}
---------------------------------------------------------------------------------------------
{{?? it}} //else if判断
	<div>...</div> ... <div>...</div>
{{?}}
	如下:
    {{?? it == 2}}
    <div>等于2的div</div>
    {{?}}
---------------------------------------------------------------------------------------------
{{for(var i in it){}} //循环遍历ret
	<div>...</div> ... <div>...</div>
{{}}}
	如下:
	{{for(var i in it){}}
        <div>{{=it[i].a)}}</div>
        <div>{{=it[i].b}}</div>
        <div>{{=it[i].c}}</div>
	{{}}}
---------------------------------------------------------------------------------------------
{{for(var ii in it[i]){}} //两次循环遍历ret中数组
	<div>...</div> ... <div>...</div>
{{}}}
	如下:
	{{for(var i in it){}}
        <div>{{=it[i].a}}</div>
            {{for(var ii in it[i]){}}
            <div>{{=it[i].b[ii]}}</div>
            {{}}}
        <div>{{=it[i].c}}</div>
	{{}}}
	
```

## 	1.2: jquery：

### 	1.2.1:页面间传值

​		**页面传值用于:  例如 列表页--->详情页  [详情页面的具体显示  需要根据列表页某一项的具体 'id' ]**

**以'牧风户外'作为栗子:a_list.html页面 需要传递act_id[“此id为后台设置的活动id”]参数到b_listDetail.html页面(b页面需要取得具体的act_id才可以显示对应的详情)** [a页面参考下1代码块;b页面参考下2和jquery ajax代码块]

```
//下1
var activityId = getQueryString('activityId');
    var postData = {};//构建数组 将数据已json格式发送到后台
    postData.act_id = activityId;
```

```
//下2
function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
------------------------------------------------------------------------------------------------

//食用方法 1:放到页面里  或者放到js里再引入js即可 2:页面里调用
```

## 	高版本jquery  ajax用法:

```
$(function(){ //jquery固定用法 页面加载时 方法即运行 类比apiready = function(){};
    $.ajax({
            url: '/path/to/file',
            type: 'default GET (Other values: POST)',
            dataType: 'default: Intelligent Guess (Other values: xml, json, script, or html)',
            data: {param1: 'value1'},
            //data:postData,
        })
        .done(function() {
            //console.log(JSON.stringify(ret))
            //console.log("success");
            此处内容搭配doT使用 or 不使用 doT 根据情况自定义
            例如 图片懒加载[图片懒加载 适用于 服务器有数据但是未加载 需要引入aui-lazyload.js]:
            new auiLazyload({
            errorImage:'../image/noimg.png'
            });
        })
        .fail(function() {
            //console.log("error");
        })
        .always(function() {
            //console.log("complete");
        });
    });
```

##  	低版本jquery  ajax用法:

```
$(function(){
        $.ajax({
            url: BASE_URL + 'Wx/Notes/notesLists',
            type: 'post',
            dataType: 'json',
            headers:{'X-APICloud-APPKey':123456,'X-APICloud-APPId':123456},
            // data: {notes_id: '1'},
            //data:postData,
            success:function(ret){ //只有此处不同于高版本(目前用到的只发现此处)
                // console.log(JSON.stringify(ret))
                if(ret){
                    // console.log(ret.data);
                    // console.log(ret.msg);
                    var tpl =document.getElementById('tpl').innerHTML;
                    var circleNoteLists =doT.template(tpl);
                    document.getElementById('list').innerHTML=circleNoteLists(ret.data);
                    // 图片懒加载 适用于 服务器有数据但是未加载。
                    new auiLazyload({
                        errorImage:'../image/noimg.png'
                    });
                }

            }
        });

    });
```
## 数组常用方法

​	push() 向数组后面添加内容
​	unshift() 向数组前面添加内容
​	pop() 删除最后一个元素
​	shift() 删除第一个元素
​	

​	join()把数组转换为字符串

```
var aaa = [1,2,3];
console.log(aaa.join("-"));
//输出的内容为 1-2-3
```

​	split()把字符串转换为数组

```
var bbb = "1-2-3";
console.log(bbb.split("-"));
//输出内容为 ["1","2","3"]   ps:  split()中的连接符 要与原字符串连接符相同
```

## 定时器

setInterval( function(){} , 1000 )  		//毫秒  每过1000毫秒 执行一次方法
clearInterval() 方法可取消由 setInterval() 函数设定的定时执行操作
setTimeout(function(){},1000)		过1000秒后 执行方法   方法只执行一次

```
html:
		<input type="text"/>
     	<button id="btn">点击发送短信</button>
js:
		var btn = document.getElementById("btn");
		var count = 5;
		var timer = null; //定时器的名字
		btn.onclick = function(){
          clearInterval(timer);
          this.disabled = true;//按钮会处于禁用状态<button type="button" disabled></button> 
          var that = this;
          timer = setInterval(sendTextMessage,1000);
          function sendTextMessage(){
            count--;
            if(count >=0){
              that.innerHTML =  "还剩余"+count+"秒";
            }else{
              	that.innerHTML = "重新发送短信";
                that.disabled = false;
                clearInterval(timer);  // 清除定时器
                count = 5;
            }
          }
		}
```

## 操作字符串

concat() 连接字符串

```
var aaa = "123";
var bbb = "zsx";
var ccc = aaa.concat(bbb);
//ccc = "123zsx"
```

slice() 从已有的数组中返回选定的元素 可提取字符串的某个部分，并以新的字符串返回被提取的部分

```
slice(“取字符串的起始位置”, [结束位置]) //[]可选
slice(3,6)     3  从第3个开始取     6  取到第6索引号的位置，还是从左边的第0个开始数。 但是不包括6
```

substr() 可在字符串中抽取从开始下标开始的指定数目的字符

```
substr(起始位置,[取的个数])
```

charAt() 方法可返回指定位置的字符 //根据位置返回字符串

indexOf() //根据字符 返回位置  从前面索引

lastIndexOf()  // 根据字符 返回位置  从后面索引

asdfgg.indexOf("f")   //3  从前面索引

lastIndexOf("g")   //5  从后面索引

## JS位置 宽高属性

### 	offset系列

​	offsetWidth (获取当前对象的宽度) width + border + padding
​	offsetHeight(获取当前对象的高度) height + border + padding
​	offsetLeft(当前对象到其上级层(最近的且带有定位的)左边的距离) 若没有定位 则以body为准 [从父级的padding开始计算 父级的border不算]    {子盒子到父盒子边框到边框的距离}   		只读属性 不能赋值
​	offsetTop (与上条相同)
​			style.top  可以得到具体的值(行内式)  并且可以赋值
​	offsetParent(返回该对象的父级(最近的父级元素 带有定位 若无定位 则为body))

### 	event系列

​	event.clientX 相对文档的水平座标  可视区域 (跟 screenX 相比就是将参照点改成了浏览器内容区域的左上角，该参照点会随之滚动条的移动而移动)
​	event.clientY 相对文档的垂直座标	可视区域
​	screenX screenY 屏幕  (鼠标位置相对于用户屏幕偏移量    此时的参照点也就是原点是屏幕的左上角)
​	pageX pageY  (参照点也是浏览器内容区域的左上角，但它不会随着滚动条而变动)
​	event.offsetX 相对容器的水平坐标
​	event.offsetY 相对容器的垂直坐标

## 常用事件--获取鼠标的位置

​	onmousemove 事件会在鼠标指针移到指定的对象时发生 	[鼠标移动]

​	onmouseout	事件会在鼠标指针移出指定的对象时发生		[离开]
​	onmouseover	事件会在鼠标指针移动到指定的元素上时发生	[经过]

​	onmouseenter 事件在鼠标指针移动到元素上时触发
​	onmouseleave 事件在鼠标移除元素时触发

​	onmousedown 事件会在鼠标按键被按下时发生
​	onmouseup 事件会在鼠标按键被松开时发生

```javascript
onmouseover、onmouseout 一对，onmouseenter、onmouseleave 一对，不能混合使用
onmouseover onmouseout 鼠标经过时自身触发事件，经过其子元素时也触发该事件；（父亲有的东西，儿子也有）
onmouseenter onmouseleave 没有事件冒泡，其他跟 onmouseover 没有区别！！！  鼠标经过时自身触发事件，经过其子元素时不触发该事件。（父亲的东西就是父亲的，不归儿子所有）
```

```javascript
[鼠标在一个盒子内的坐标(获取鼠标的位置)]
HTML:
<div class="zsx"></div>
js:
var div = document.getElementsByTagName("div")[0];
div.onmousemove = function(event) {
  	var event = event || window.event;
  	var x = event.clientX - this.offsetLeft;
  	var y = event.clientY - this.offsetTop;
  	this.innerHTML = x + "px" + y + "px";
}
```

## 常用事件--窗口

```javascript
window.onscroll = function(){} //屏幕滚动事件
window.onresize = function(){} //窗口改变事件
```

## 事件冒泡和事件捕获 

​	阻止冒泡 event.stopPropagation()

```html
<div id="parent">
　　<div id="child" class="child"></div>
</div>
```

```javascript
document.getElementById("parent").addEventListener("click",function(e){
  alert("parent事件被触发，"+this.id);
})
document.getElementById("child").addEventListener("click",function(e){
  alert("child事件被触发，"+this.id)
})
/*child事件被触发，child
  parent事件被触发，parent
*/
/*先 child，然后 parent。[事件的触发顺序自内向外]，这就是[事件冒泡]
*/
```

```javascript
document.getElementById("parent").addEventListener("click",function(e){
  alert("parent事件被触发，"+e.target.id);
},true)
document.getElementById("child").addEventListener("click",function(e){
  alert("child事件被触发，"+e.target.id)
},true)
/*parent事件被触发，parent
  child事件被触发，child
*/
/*先 parent, 然后 child。[事件触发顺序变更为自外向内]，这就是[事件捕获]
*/
```



## 获取拖拽盒子的位置

## 拖动时防止被选中

​	window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty()

## 保留小数位数

```
var num = 11223344.12345;	//假设 保留 两位小数位
console.log(num.substr(0,num.indexOf(".")+3)); //通过 indexOf  返回小数点的位置     截取字符串
console.log(parseInt(num*100) /100); //先乘以100  取整  然后 除以100
console.log(num.toFixed(2));	//toFixed() 方法
ps:	toFixed()可把 Number 四舍五入为指定小数位数的数字
```

## 大小写转换

toUpperCase()  转换为大写

toLowerCase() 转换为小写

## 访问关系(节点)

父节点:parentNode   返回亲父亲 不管父亲是否带有定位

兄弟节点:	
​	nextSibling   返回元素节点之后的兄弟节点（包括文本节点、注释节点即回车、换行、空格、文本等等）
​	nextElementSibling   只返回元素节点之后的兄弟元素节点（不包括文本节点、注释节点）
​	previousSibling  获取元素的上一个兄弟节点；（既包含元素节点、文本节点、注释节点）
​	previousElementSibling	获取上一个兄弟元素节点；（只包含元素节点）

子节点:
​	firstChild 返回被选节点的第一个子节点(既包含元素节点、文本节点、注释节点)
​	firstElementChild  返回被选节点的第一个子节点(只包含元素节点)
​	lastChild 返回被选节点的最后一个子节点(既包含元素节点、文本节点、注释节点)
​	lastElementChild  返回被选节点的最后一个子节点(只包含元素节点)

所有子节点
​	childNodes  返回节点的子节点集合，以 NodeList 对象 (既包含元素节点、文本节点、注释节点)
​	children  返回节点的子节点集合，以 NodeList 对象 (只包含元素节点)



appendChild()	向节点的子节点列表的末尾添加新的子节点
createElement()	通过指定名称创建一个元素
insertBefore() 	在已有的子节点前插入一个新的子节点

nodeType()	返回节点类型