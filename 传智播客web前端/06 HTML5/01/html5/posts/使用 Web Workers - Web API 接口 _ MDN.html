<!DOCTYPE html>
<!-- saved from url=(0082)https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers -->
<html lang="zh-CN" dir="ltr" class="redesign " data-ffo-opensanslight="true" data-ffo-opensans="true"><head prefix="og: http://ogp.me/ns#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  
        
    <title>使用 Web Workers - Web API 接口 | MDN</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="index, follow">
  <link rel="home" href="https://developer.mozilla.org/zh-CN/">
  <link rel="copyright" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#copyright">

              <link rel="stylesheet" media="all" href="使用 Web Workers - Web API 接口 _ MDN_files/mdn-min.css">

      
    <link rel="stylesheet" media="all" href="使用 Web Workers - Web API 接口 _ MDN_files/wiki-min.css">

    
    
  <!-- common social tags -->
    <meta property="og:type" content="website">
  <meta property="og:image" content="https://developer.mozilla.org/media/img/opengraph-logo.png">
  <meta property="og:site_name" content="Mozilla 开发者网络">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://developer.mozilla.org/media/img/opengraph-logo.png">
  <meta name="twitter:site" content="@MozDevNet">
  <meta name="twitter:creator" content="@MozDevNet">

  <link rel="search" type="application/opensearchdescription+xml" href="https://developer.mozilla.org/zh-CN/search/xml" title="Mozilla 开发者网络">

  <!-- third-generation iPad with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://developer.cdn.mozilla.net/media/img/favicon144.png">
  <!-- iPhone with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://developer.cdn.mozilla.net/media/img/favicon114.png">
  <!-- first- and second-generation iPad: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://developer.cdn.mozilla.net/media/img/favicon72.png">
  <!-- non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="https://developer.cdn.mozilla.net/media/img/favicon57.png">
  <!-- basic favicon -->
          <link rel="shortcut icon" href="https://developer.cdn.mozilla.net/media/img/favicon32.png">
  <!--[if IE]>
  <meta http-equiv="imagetoolbar" content="no">
  <script src="https://developer.cdn.mozilla.net/media/js/libs/html5.js"></script>
  <![endif]-->

    <link rel="alternate" type="application/json" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers$json">
  <link rel="canonical" href="使用 Web Workers - Web API 接口 _ MDN_files/使用 Web Workers - Web API 接口 _ MDN.html">

            <link rel="alternate" hreflang="fr" href="https://developer.mozilla.org/fr/docs/Utilisation_des_web_workers" title="Utilisation des web workers">
          <link rel="alternate" hreflang="en-US" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" title="Using Web Workers">
          <link rel="alternate" hreflang="ja" href="https://developer.mozilla.org/ja/docs/Web/Guide/Performance/Using_web_workers" title="Web Worker を使用する">
          <link rel="alternate" hreflang="nl" href="https://developer.mozilla.org/nl/docs/Gebruik_maken_van_DOM_workers" title="Gebruik DOM workers">
          <link rel="alternate" hreflang="ru" href="https://developer.mozilla.org/ru/docs/DOM/Using_web_workers" title="Using web workers">
          <link rel="alternate" hreflang="zh-TW" href="https://developer.mozilla.org/zh-TW/docs/Web/Guide/Performance/Using_web_workers" title="使用 web workers">
          <link rel="alternate" hreflang="es" href="https://developer.mozilla.org/es/docs/Web/Guide/Performance/Usando_web_workers" title="Usando web workers">
          <link rel="alternate" hreflang="pl" href="https://developer.mozilla.org/pl/docs/Web/Guide/Performance/Uzycie_web_workers" title="Użycie web workers">
          <link rel="alternate" hreflang="ko" href="https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API/basic_usage" title="웹워커 사용하기">
      
  <!-- document-specific social tags -->
  <meta property="og:title" content="使用 Web Workers">
  <meta property="og:url" content="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers">
  <meta name="twitter:url" content="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers">
  <meta name="twitter:title" content="使用 Web Workers">
    <meta property="og:description" content="专用 Web Worker (Dedicated Web Worker) 提供了一个简单的方法使得 web 内容能够在后台运行脚本。一旦 worker 创建后，它可以向由它的创建者指定的事件监听函数传递消息，这样该 worker 生成的所有任务就都会接收到这些消息。">
  <meta name="description" content="专用 Web Worker (Dedicated Web Worker) 提供了一个简单的方法使得 web 内容能够在后台运行脚本。一旦 worker 创建后，它可以向由它的创建者指定的事件监听函数传递消息，这样该 worker 生成的所有任务就都会接收到这些消息。">
  <meta name="twitter:description" content="专用 Web Worker (Dedicated Web Worker) 提供了一个简单的方法使得 web 内容能够在后台运行脚本。一旦 worker 创建后，它可以向由它的创建者指定的事件监听函数传递消息，这样该 worker 生成的所有任务就都会接收到这些消息。">
  
      
  </head>
<body data-slug="Web/API/Web_Workers_API/Using_web_workers" contextmenu="edit-history-menu" class="document  ">

  
  

  <ul id="nav-access">
    <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#document-main" id="skip-main">跳到主要内容</a></li>
    <li><a id="skip-language" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#language">选择语言</a></li>
          <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#q" id="skip-search">跳到搜索</a></li>
      </ul>

  <!-- Header -->
  <header id="main-header"><div class="center">

    <div id="tabzilla">
        <a href="https://www.mozilla.org/" class="no-track">mozilla</a>
    </div>

    <div class="clear header-clear"></div>

            <a href="https://developer.mozilla.org/zh-CN/" class="logo logo-mdn10">Mozilla 开发者网络</a>
    
    <div id="nav-sec">
        
                          
    
    <form>
      <div class="oauth-login-container">
          <div class="oauth-login-options" tabindex="0">
              <span class="oauth-login-options-text">
                <span class="oauth-login-options-text-icons">登录方式</span>
                <span class="oauth-login-options-text-no-icons">登录</span>
              </span>
              <span class="oauth-icon oauth-persona launch-persona-login" data-service="Persona" data-next="/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" title="Persona"><i class="icon-user" aria-hidden="true"></i></span>
              <span class="oauth-icon oauth-github" data-service="GitHub" data-href="/users/github/login/?next=%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWeb_Workers_API%2FUsing_web_workers" title="GitHub"><i class="icon-github" aria-hidden="true"></i></span>
          </div>
          <div class="oauth-login-picker" aria-hidden="true">
              <ul>
                  <li><a href="https://developer.mozilla.org/zh-CN/users/signin" class="login-link launch-persona-login" data-next="/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" data-service="Persona"><i class="icon-user" aria-hidden="true"></i>Persona</a></li>
                  <li><a href="https://developer.mozilla.org/users/github/login/?next=%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWeb_Workers_API%2FUsing_web_workers" class="login-link" data-service="GitHub"><i class="icon-github" aria-hidden="true"></i>GitHub</a></li>
              </ul>
          </div>
      </div>
    </form>
                        </div>

    <nav id="main-nav" role="navigation"><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web">网络平台<i aria-hidden="true" class="icon-caret-down"></i></a>

        <div class="submenu submenu-cols-2 js-submenu" id="nav-platform-submenu">
          <div class="submenu-column">
            <div class="title">技术</div>
            <ul>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML">HTML</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS">CSS</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">JavaScript</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/Graphics">图像</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API">API / DOM</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Apps">应用</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/MathML">MathML</a></li>
            </ul>
          </div><div class="submenu-column last">
            <div class="title">参考和指引</div>
            <ul>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Learn">了解 Web</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Tutorials">教程</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Reference">参考文献</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide">开发者指南</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Accessibility">无障碍环境</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/demos/">演示</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Web">...更多文档</a></li>
            </ul>
          </div>
        </div>
      </li><li><a href="https://developer.mozilla.org/zh-CN/docs/Zones">Mozilla 文档<i aria-hidden="true" class="icon-caret-down"></i></a>

        <div class="submenu js-submenu" id="nav-zones-submenu">
          <div class="submenu-column">
            <ul>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons">附加组件</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Firefox">Firefox</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Marketplace">火狐应用市场</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Firefox_OS">Firefox OS</a></li>
              <li><a href="https://developer.mozilla.org/zh-CN/docs/Persona">Persona</a></li>
            </ul>
          </div>
        </div>
      </li><li><a href="https://developer.mozilla.org/zh-CN/docs/Tools">开发者工具</a></li><li><a href="https://developer.mozilla.org/zh-CN/demos/">演示</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Connect">连接</a></li><li class="nav-search-link"><a href="https://developer.mozilla.org/zh-CN/search" title="Search"><i aria-hidden="true" class="icon-search"></i></a></li><li class="main-nav-search"><form action="https://developer.mozilla.org/zh-CN/search" method="get" role="search">
        <div class="search-wrap">
          <label for="main-q" class="offscreen">搜索</label>
          <input type="search" id="main-q" name="q" placeholder="搜索" data-value="" value="">
          <span class="search-trigger"><i aria-hidden="true" class="icon-search"></i></span>&nbsp;
          <button type="submit" class="offscreen">搜索</button>
        </div>
      </form></li></ul></nav>
  </div></header>

  <!-- Content will go here -->
  <main id="content"><div class="center clear">
  
   <!-- end is_zone -->


    <div class="wiki-main-content" id="document-main" role="main"><div class="center">
            <div class="article-meta">
        <!-- action buttons -->
        
            
        

  <ul class="page-buttons" data-sticky="false"><li><button id="languages-menu" class="transparent" aria-haspopup="true" aria-owns="languages-menu-submenu" aria-expanded="false"><span>语言</span><i aria-hidden="true" class="icon-globe"></i></button>

        <div class="submenu js-submenu" id="languages-menu-submenu">
          <div class="submenu-column">
            <ul id="translations">
                                                <li><bdi><a rel="internal" href="https://developer.mozilla.org/fr/docs/Utilisation_des_web_workers" title="Utilisation des web workers">Français</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" title="Using Web Workers">English (US)</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/ja/docs/Web/Guide/Performance/Using_web_workers" title="Web Worker を使用する">日本語</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/nl/docs/Gebruik_maken_van_DOM_workers" title="Gebruik DOM workers">Nederlands</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/ru/docs/DOM/Using_web_workers" title="Using web workers">Русский</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/zh-TW/docs/Web/Guide/Performance/Using_web_workers" title="使用 web workers">正體中文 (繁體)</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/es/docs/Web/Guide/Performance/Usando_web_workers" title="Usando web workers">Español</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/pl/docs/Web/Guide/Performance/Uzycie_web_workers" title="Użycie web workers">Polski</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API/basic_usage" title="웹워커 사용하기">한국어</a></bdi></li>
                              
                          </ul>
          </div>
        </div></li><li class="page-buttons-edit"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers$edit" class="button" data-optimizely-hook="button-edit-doc" id="edit-button">编辑<i aria-hidden="true" class="icon-pencil"></i></a></li><li><button id="advanced-menu" class="only-icon" aria-haspopup="true" aria-owns="advanced-menu-submenu" aria-expanded="false"><span>高级</span><i aria-hidden="true" class="icon-cog"></i></button>

        <div class="submenu js-submenu" id="advanced-menu-submenu">
          <!-- this page -->
          <div class="submenu-column">
            <div class="title">高级</div>
            <ul>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers$history" rel="nofollow, noindex">历史记录</a></li>
                                                                
                
                                                                <li class="page-print"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#" onclick="return window.print();">打印此页</a></li>
            </ul>
          </div>
        </div>
  </li></ul>

        <!-- crumbs -->
          <nav class="crumbs" role="navigation"><ol xmlns:v="http://rdf.data-vocabulary.org/#" aria-label="面包屑导航">
    <li typeof="v:Breadcrumb"><a href="https://developer.mozilla.org/zh-CN" rel="v:url" property="v:title">MDN</a></li>
          <li class="crumb" typeof="v:Breadcrumb"><a href="https://developer.mozilla.org/zh-CN/docs/Web" rel="v:url" property="v:title">Web 技术文档</a></li>
          <li class="crumb" typeof="v:Breadcrumb"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API" rel="v:url" property="v:title">Web API 接口</a></li>
          <li class="crumb" typeof="v:Breadcrumb"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API" rel="v:url" property="v:title">Web Workers API</a></li>
        <li class="crumb" typeof="v:Breadcrumb" property="v:title">使用 Web Workers</li>
  </ol></nav>
      </div>

      <!-- heading -->
      <div id="wiki-document-head" class="document-head">
          <span class="from-search-previous-box">
            <a class="button from-search-previous only-icon disabled" title="前一个搜索结果" data-empty-title="没有更靠前的搜索结果"><i aria-hidden="true" class="icon-chevron-left"></i></a>
          </span>
          <span class="from-search-navigate-wrap">
            <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#" class="from-search-navigate"><span class="from-search-navigate-up"><i aria-hidden="true" class="icon-double-angle-up"></i></span><span class="from-search-navigate-down"><i aria-hidden="true" class="icon-double-angle-down"></i></span></a>
          </span>
          <div class="from-search-toc submenu">
            <span class="title">您的搜索结果</span>
            <ol></ol>
          </div>
          <span class="from-search-next-box">
            <a class="button from-search-next only-icon disabled" title="后一个搜索结果" data-empty-title="没有更靠前的搜索结果"><i aria-hidden="true" class="icon-chevron-right"></i></a>
          </span>

        <h1>使用 Web Workers</h1>

        
                <div class="contributor-avatars" data-all-text="全部显示…<span class='hidden'>贡献者</span>">
            <span class="quickstat">
            5 位贡献者：            </span>
            <ul>
                            <li class="shown">
                <a href="https://developer.mozilla.org/zh-CN/profiles/ziyunfei" title="查看个人资料：ziyunfei">
                <img src="使用 Web Workers - Web API 接口 _ MDN_files/2dbf9c055c2b32d3ca45d25be0117423" class="avatar loaded" alt="ziyunfei"></a>
                </li>
                            <li class="shown">
                <a href="https://developer.mozilla.org/zh-CN/profiles/fscholz" title="查看个人资料：fscholz">
                <img src="使用 Web Workers - Web API 接口 _ MDN_files/e24391c9174352988d819a9b9ea77c9e" class="avatar loaded" alt="fscholz"></a>
                </li>
                            <li class="shown">
                <a href="https://developer.mozilla.org/zh-CN/profiles/siberiawolf0307" title="查看个人资料：siberiawolf0307">
                <img src="使用 Web Workers - Web API 接口 _ MDN_files/e0053c0464ae5c43cda2669182b5708f" class="avatar"></a>
                </li>
                            <li class="shown">
                <a href="https://developer.mozilla.org/zh-CN/profiles/sunnylost" title="查看个人资料：sunnylost">
                <img src="使用 Web Workers - Web API 接口 _ MDN_files/c5153e775b58787cf81bd0a2013c0368" class="avatar loaded" alt="sunnylost"></a>
                </li>
                            <li class="shown">
                <a href="https://developer.mozilla.org/zh-CN/profiles/xcffl" title="查看个人资料：xcffl">
                <img src="使用 Web Workers - Web API 接口 _ MDN_files/16ef6d47b095bdd2c5c893f21ae01f43" class="avatar loaded" alt="xcffl"></a>
                </li>
                        </ul>
        </div>
        
      </div>
      
      <!-- start the main content container -->
        <div id="wiki-column-container" class="wiki-right-present wiki-left-closed wiki-left-none">

          
          <!-- content row with three strips -->
          <div class="column-container column-container-reverse">

                          <!-- TOC, approvals, etc -->
              <div class="column-strip wiki-column" id="wiki-right">
                            <!-- table of contents -->
              <div id="toc" class="toc toggleable" style="width: auto; max-height: none;">
                <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#toc" class="title toggler" data-open-icon="icon-plus" data-closed-icon="icon-minus" aria-haspopup="true">在本文章中<i class="icon-minus"></i></a>
                <ol class="toggle-container">
                  <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.85.B3.E4.BA.8E.E7.BA.BF.E7.A8.8B.E5.AE.89.E5.85.A8" rel="internal">关于线程安全</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E7.94.9F.E6.88.90_worker" rel="internal">生成 worker</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E4.BC.A0.E9.80.92.E6.95.B0.E6.8D.AE" rel="internal">传递数据</a><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E4.BC.A0.E9.80.92.E6.95.B0.E6.8D.AE.E7.9A.84.E4.BE.8B.E5.AD.90" rel="internal">传递数据的例子</a><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E4.BE.8B.E5.AD.90_.231.EF.BC.9A_.E5.88.9B.E5.BB.BA.E4.B8.80.E4.B8.AA.E9.80.9A.E7.94.A8.E7.9A.84_.E3.80.8C.E5.BC.82.E6.AD.A5_eval().E3.80.8D" rel="internal">例子 #1： 创建一个通用的 「异步&nbsp;<code>eval()</code>」</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E4.BE.8B.E5.AD.90_.232.EF.BC.9A.E4.BC.A0.E8.BE.93_JSON_.E7.9A.84.E9.AB.98.E7.BA.A7.E6.96.B9.E5.BC.8F.E5.92.8C.E5.88.9B.E5.BB.BA.E4.B8.80.E4.B8.AA.E4.BA.A4.E6.8D.A2.E7.B3.BB.E7.BB.9F" rel="internal">例子 #2：传输 JSON 的高级方式和创建一个交换系统</a></li></ol></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E9.80.9A.E8.BF.87.E8.BD.AC.E8.AE.A9.E6.89.80.E6.9C.89.E6.9D.83(.E5.8F.AF.E8.BD.AC.E8.AE.A9.E5.AF.B9.E8.B1.A1).E6.9D.A5.E4.BC.A0.E9.80.92.E6.95.B0.E6.8D.AE" rel="internal">通过转让所有权(可转让对象)来传递数据</a></li></ol></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E7.94.9F.E6.88.90subworker" rel="internal">生成subworker</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.B5.8C.E5.85.A5.E5.BC.8F_worker" rel="internal">嵌入式 worker</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E8.B6.85.E6.97.B6.E4.B8.8E.E9.97.B4.E9.9A.94" rel="internal">超时与间隔</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E7.BB.88.E6.AD.A2_worker" rel="internal">终止 worker</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.A4.84.E7.90.86.E9.94.99.E8.AF.AF" rel="internal">处理错误</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E8.AE.BF.E9.97.AE_navigator_.E5.AF.B9.E8.B1.A1" rel="internal">访问 navigator 对象</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.BC.95.E5.85.A5.E8.84.9A.E6.9C.AC.E4.B8.8E.E5.BA.93" rel="internal">引入脚本与库</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E4.BE.8B.E5.AD.90" rel="internal">例子</a><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.9C.A8.E5.90.8E.E5.8F.B0.E6.89.A7.E8.A1.8C.E8.BF.90.E7.AE.97" rel="internal">在后台执行运算</a><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#JavaScript_.E4.BB.A3.E7.A0.81" rel="internal">JavaScript 代码</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#HTML_.E4.BB.A3.E7.A0.81" rel="internal">HTML 代码</a></li></ol></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.9C.A8.E5.90.8E.E5.8F.B0.E8.BF.90.E8.A1.8C_web_I.2FO" rel="internal">在后台运行 web I/O</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.88.92.E5.88.86.E4.BB.BB.E5.8A.A1.E7.BB.99.E5.A4.9A.E4.B8.AA_worker" rel="internal">划分任务给多个 worker</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#.E5.9C.A8_worker_.E5.86.85.E5.88.9B.E5.BB.BA_worker" rel="internal">在 worker 内创建 worker</a></li></ol></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#Browser_Compatibility" rel="internal">浏览器兼容性</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#See_also" rel="internal">See also</a>
                </li></ol>
                              </div>
                            </div>
            
                                                  
            <!-- center: main article content -->
            <div id="wiki-content" class="column-main wiki-column text-content">

              
              
                                                                                          
              <!-- just the article content -->
              <article id="wikiArticle">
                                                      <p>专用 Web Worker (Dedicated Web Worker) 提供了一个简单的方法使得 web 内容能够在后台运行脚本。一旦 worker 创建后，它可以向由它的创建者指定的事件监听函数传递消息，这样该 worker 生成的所有任务就都会接收到这些消息。</p>

<p>worker 线程能够在不干扰 UI 的情况下执行任务。另外，它还能够使用&nbsp;<code><a class="internal" href="https://developer.mozilla.org/en/nsIXMLHttpRequest" title="En/XMLHttpRequest">XMLHttpRequest</a></code> (虽然&nbsp;<code>responseXML</code>&nbsp;与&nbsp;<code>channel 两个属性值始终是&nbsp;</code>null)来执行&nbsp;<span style="line-height: inherit;">&nbsp;I/O 操作。</span></p>

<p>查看 worker 的参考文档 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker" title="Worker 是可以在后台运行的任务，它能够被轻松的创建，还能向它的创建者发送消息。 你只要调用&nbsp;Worker()&nbsp;构造函数，指定一个需要运行在 worker 线程内的脚本，就能够很容易的创建一个 worker。"><code>Worker</code></a>；本文通过提供例子和细节补全了前面的文档。<a href="https://developer.mozilla.org/en/DOM/Worker/Functions_available_to_workers" title="En/DOM/Worker/Functions available to workers">提供给 worker 的函数</a>&nbsp;列出了 worker 所支持的函数。</p>

<h2 id=".E5.85.B3.E4.BA.8E.E7.BA.BF.E7.A8.8B.E5.AE.89.E5.85.A8">关于线程安全</h2>

<p><code>Worker</code>&nbsp;接口会生成真正的操作系统级别的线程，如果你不太小心，那么并发(<span style="line-height: 21px;">concurrency</span><span style="line-height: inherit;">)会对你的代码产生有趣的影响。然而，对于 web worker 来说，与其他线程的通信点会被很小心的控制，这意味着你很难引起并发问题。你没有办法去访问非线程安全的组件或者是 DOM，此外你还需要通过序列化对象来与线程交互特定的数据。所以你要是不费点劲儿，还真搞不出错误来。</span></p>

<h2 id=".E7.94.9F.E6.88.90_worker">生成 worker</h2>

<p>创建一个新的 worker 十分简单。你所要做的就是调用&nbsp;<code>Worker()</code>&nbsp;构造函数，指定一个要在 worker 线程内运行的脚本的 URI，如果你希望能够收到 worker 的通知，可以将 worker 的&nbsp;<code>onmessage</code>&nbsp;属性设置成一个特定的事件处理函数。</p>

<div style="overflow: hidden;">
<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"my_task.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myWorker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"Called back by the worker!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div></code></pre>
</div>

<p>或者，你也可以使用&nbsp;<code>addEventListener()：</code></p>

<div style="overflow: hidden;">
<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"my_task.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myWorker<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"Called back by the worker!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myWorker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // start the worker.</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div></code></pre>
</div>

<p>例子中的第一行创建了一个新的 worker 线程。第三行为 worker 设置了&nbsp;<code>message</code>&nbsp;事件的监听函数。当 worker 调用自己的&nbsp;<code>postMessage() 函数时就会调用这个事件处理函数。最后，第七行启动了 worker 线程。</code></p>

<div class="note"><strong>注意</strong>： 传入 <code>Worker</code>&nbsp;构造函数的参数 URI 必须遵循&nbsp;<a href="https://developer.mozilla.org/en/Same_origin_policy_for_JavaScript" title="Same origin policy for JavaScript">同源策略</a>。目前，不同的浏览器制造商对于哪些 URI 应该遵循同源策略尚有分歧；Gecko 10.0 (Firefox 10.0 / Thunderbird 10.0 / SeaMonkey 2.7) 及后续版本允许传入 data URI，而 Internet Explorer 10 则不认为 Blob URI 对于 worker 来说是一个有效的脚本。</div>

<h2 id=".E4.BC.A0.E9.80.92.E6.95.B0.E6.8D.AE">传递数据</h2>

<p>在主页面与 worker 之间传递的数据是通过<strong>拷贝</strong>，而不是共享来完成的。传递给&nbsp;<code>worker 的对象需要经过序列化，接下来在另一端还需要反序列化。页面与 worker&nbsp;</code><strong>不会共享同一个实例，</strong>最终的结果就是在每次通信结束时生成了数据的<strong>一个副本。</strong>大部分浏览器使用<a href="https://developer.mozilla.org/en/DOM/The_structured_clone_algorithm" title="The structured clone algorithm">结构化拷贝</a>来实现该特性。</p>

<p>在往下进行之前，出于教学的目的，让我们创建一个名为&nbsp;<code>emulateMessage()</code>&nbsp;的函数，它将模拟在从<span style="line-height: inherit;">&nbsp;</span><code style="font-size: 14px; line-height: inherit;">worker</code><span style="line-height: inherit;">&nbsp;</span><span style="line-height: inherit;">到主页面(反之亦然)的通信过程中，变量的</span><span style="line-height: inherit;">「</span><em>拷贝而非共享</em><span style="line-height: inherit;">」</span><span style="line-height: inherit;">行为：</span></p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token keyword">function</span> emulateMessage <span class="token punctuation">(</span>vVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">eval<span class="token punctuation">(</span></span><span class="token string">"("</span> <span class="token operator">+</span> JSON<span class="token punctuation">.</span><span class="token function">stringify<span class="token punctuation">(</span></span>vVal<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">
// Tests
</span><span class="token comment" spellcheck="true">
// test #1
</span><span class="token keyword">var</span> example1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> example1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // object
</span><span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> <span class="token function">emulateMessage<span class="token punctuation">(</span></span>example1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // number
</span><span class="token comment" spellcheck="true">
// test #2
</span><span class="token keyword">var</span> example2 <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
<span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> example2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // boolean
</span><span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> <span class="token function">emulateMessage<span class="token punctuation">(</span></span>example2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // boolean
</span><span class="token comment" spellcheck="true">
// test #3
</span><span class="token keyword">var</span> example3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> example3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // object
</span><span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> <span class="token function">emulateMessage<span class="token punctuation">(</span></span>example3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // string
</span><span class="token comment" spellcheck="true">
// test #4
</span><span class="token keyword">var</span> example4 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"John Smith"</span><span class="token punctuation">,</span>
    <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">43</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> example4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // object
</span><span class="token function">alert<span class="token punctuation">(</span></span><span class="token keyword">typeof</span> <span class="token function">emulateMessage<span class="token punctuation">(</span></span>example4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // object
</span><span class="token comment" spellcheck="true">
// test #5
</span><span class="token keyword">function</span> Animal <span class="token punctuation">(</span>sType<span class="token punctuation">,</span> nAge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> sType<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> nAge<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> example5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">"Cat"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert<span class="token punctuation">(</span></span>example5<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // Animal
</span><span class="token function">alert<span class="token punctuation">(</span></span><span class="token function">emulateMessage<span class="token punctuation">(</span></span>example5<span class="token punctuation">)</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // Object</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div><div class="line-number" data-start="30" style="top: 551px;"></div><div class="line-number" data-start="31" style="top: 570px;"></div><div class="line-number" data-start="32" style="top: 589px;"></div><div class="line-number" data-start="33" style="top: 608px;"></div><div class="line-number" data-start="34" style="top: 627px;"></div><div class="line-number" data-start="35" style="top: 646px;"></div><div class="line-number" data-start="36" style="top: 665px;"></div><div class="line-number" data-start="37" style="top: 684px;"></div></code></pre>

<p>拷贝而并非共享的那个值称为&nbsp;<em>消息</em>。再来谈谈&nbsp;<code>worker，你可以使用<font face="Lucida Grande, Lucida Sans Unicode, DejaVu Sans, Lucida, Arial, Helvetica, sans-serif">&nbsp;</font></code><span style="font-family: 'Courier New', 'Andale Mono', monospace; line-height: inherit;">postMessage() 将消息传递给主线程或从主线程传送回来。</span><code style="font-size: 14px; line-height: inherit;">message</code><span style="line-height: inherit;">&nbsp;事件的&nbsp;</span><code style="font-size: 14px; line-height: inherit;">data</code><span style="line-height: inherit;">&nbsp;属性就包含了从 worker 传回来的数据。</span></p>

<p><strong>example.html</strong>: (主页面):</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"my_task.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myWorker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"Worker said : "</span> <span class="token operator">+</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myWorker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token string">"ali"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div></code></pre>

<p><strong>my_task.js</strong> (worker):</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token string">"I\'m working before postMessage(\'ali\')."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token string">"Hi "</span> <span class="token operator">+</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div></code></pre>

<div class="note"><strong>注意：</strong>&nbsp;通常来说，后台线程 – 包括 worker – <strong>无法操作 DOM。</strong>&nbsp;如果后台线程需要修改 DOM，那么它应该将消息发送给它的创建者，让创建者来完成这些操作。</div>

<p>如你所见，<code>worker</code>&nbsp;与主页面之间传输的&nbsp;<em>消息&nbsp;</em><strong style="line-height: inherit;">始终是&nbsp;</strong><span style="line-height: inherit;">「</span><strong style="line-height: inherit;"><a href="https://developer.mozilla.org/en-US/docs/JSON" title="/en-US/docs/JSON">JSON 消息</a></strong><span style="line-height: inherit;">」，即使它是一个原始类型的值。所以，你完全可以传输</span><span style="line-height: inherit;">&nbsp;</span><a href="https://developer.mozilla.org/en-US/docs/JSON" style="line-height: inherit;" title="/en-US/docs/JSON"><code>JSON</code></a><span style="line-height: inherit;">&nbsp;数据 和/或 任何能够序列化的数据类型：</span></p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token punctuation">{</span><span class="token string">"cmd"</span><span class="token punctuation">:</span> <span class="token string">"init"</span><span class="token punctuation">,</span> <span class="token string">"timestamp"</span><span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div></code></pre>

<h3 id=".E4.BC.A0.E9.80.92.E6.95.B0.E6.8D.AE.E7.9A.84.E4.BE.8B.E5.AD.90">传递数据的例子</h3>

<h4 id=".E4.BE.8B.E5.AD.90_.231.EF.BC.9A_.E5.88.9B.E5.BB.BA.E4.B8.80.E4.B8.AA.E9.80.9A.E7.94.A8.E7.9A.84_.E3.80.8C.E5.BC.82.E6.AD.A5_eval().E3.80.8D">例子 #1： 创建一个通用的 「异步&nbsp;<a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/eval" title="/en-US/docs/JavaScript/Reference/Global_Objects/eval"><code>eval()</code></a>」</h4>

<p>下面这个例子介绍了，如何在 worker 内使用&nbsp;<span style="line-height: inherit;">&nbsp;</span><code style="line-height: inherit; font-size: 14px;"><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/eval" style="line-height: inherit;" title="/en-US/docs/JavaScript/Reference/Global_Objects/eval">eval()</a>&nbsp;</code><span style="line-height: inherit;">来按顺序执行</span><strong style="line-height: inherit;">异步的</strong><span style="line-height: inherit;">任何种类的 JavaScript 代码：</span></p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token comment" spellcheck="true">// Syntax: asyncEval(code[, listener])
</span>
<span class="token keyword">var</span> asyncEval <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> aListeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> oParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"data:text/javascript;charset=US-ASCII,onmessage%20%3D%20function%20%28oEvent%29%20%7B%0A%09postMessage%28%7B%0A%09%09%22id%22%3A%20oEvent.data.id%2C%0A%09%09%22evaluated%22%3A%20eval%28oEvent.data.code%29%0A%09%7D%29%3B%0A%7D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  oParser<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aListeners<span class="token punctuation">[</span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> aListeners<span class="token punctuation">[</span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">(</span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>evaluated<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> aListeners<span class="token punctuation">[</span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>sCode<span class="token punctuation">,</span> fListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    aListeners<span class="token punctuation">.</span><span class="token function">push<span class="token punctuation">(</span></span>fListener <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oParser<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
      <span class="token string">"id"</span><span class="token punctuation">:</span> aListeners<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token string">"code"</span><span class="token punctuation">:</span> sCode
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div></code></pre>

<p>示例使用：</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token comment" spellcheck="true">// asynchronous alert message...
</span><span class="token function">asyncEval<span class="token punctuation">(</span></span><span class="token string">"3 + 2"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>sMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert<span class="token punctuation">(</span></span><span class="token string">"3 + 2 = "</span> <span class="token operator">+</span> sMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// asynchronous print message...
</span><span class="token function">asyncEval<span class="token punctuation">(</span></span><span class="token string">"\"Hello World!!!\""</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>sHTML<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild<span class="token punctuation">(</span></span>document<span class="token punctuation">.</span><span class="token function">createTextNode<span class="token punctuation">(</span></span>sHTML<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// asynchronous void...
</span><span class="token function">asyncEval<span class="token punctuation">(</span></span><span class="token string">"(function () {\n\tvar oReq = new XMLHttpRequest();\n\toReq.open(\"get\", \"http://www.mozilla.org/\", false);\n\toReq.send(null);\n\treturn oReq.responseText;\n})()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div></code></pre>

<h4 id=".E4.BE.8B.E5.AD.90_.232.EF.BC.9A.E4.BC.A0.E8.BE.93_JSON_.E7.9A.84.E9.AB.98.E7.BA.A7.E6.96.B9.E5.BC.8F.E5.92.8C.E5.88.9B.E5.BB.BA.E4.B8.80.E4.B8.AA.E4.BA.A4.E6.8D.A2.E7.B3.BB.E7.BB.9F">例子 #2：传输 JSON 的高级方式和创建一个交换系统</h4>

<p>如果你需要传输非常复杂的数据，还要同时在主页与 Worker 内调用多个方法，那么可以考虑创建一个类似下面的系统。</p>

<p><strong>example.html</strong> (the main page):</p>

<pre class="brush: html  language-html" data-number=""><code class=" language-html">&lt;!doctype html&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span>  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>MDN Example - Queryable worker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment" spellcheck="true">/*
    QueryableWorker instances methods:
     * sendQuery(queryable function name, argument to pass 1, argument to pass 2, etc. etc): calls a Worker's queryable function
     * postMessage(string or JSON Data): see Worker.prototype.postMessage()
     * terminate(): terminates the Worker
     * addListener(name, function): adds a listener
     * removeListener(name): removes a listener
    QueryableWorker instances properties:
     * defaultListener: the default listener executed only when the Worker calls the postMessage() function directly
  */</span>
  <span class="token keyword">function</span> QueryableWorker <span class="token punctuation">(</span>sURL<span class="token punctuation">,</span> fDefListener<span class="token punctuation">,</span> fOnError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> oInstance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span> oWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>sURL<span class="token punctuation">)</span><span class="token punctuation">,</span> oListeners <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defaultListener <span class="token operator">=</span> fDefListener <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    oWorker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">.</span>data <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty<span class="token punctuation">(</span></span><span class="token string">"vo42t30"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty<span class="token punctuation">(</span></span><span class="token string">"rnb93qh"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        oListeners<span class="token punctuation">[</span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>vo42t30<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply<span class="token punctuation">(</span></span>oInstance<span class="token punctuation">,</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>rnb93qh<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>defaultListener<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>oInstance<span class="token punctuation">,</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fOnError<span class="token punctuation">)</span> <span class="token punctuation">{</span> oWorker<span class="token punctuation">.</span>onerror <span class="token operator">=</span> fOnError<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sendQuery <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token comment" spellcheck="true">/* queryable function name, argument to pass 1, argument to pass 2, etc. etc */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"QueryableWorker.sendQuery - not enough arguments"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      oWorker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token punctuation">{</span> <span class="token string">"bk4e1h0"</span><span class="token punctuation">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"ktp3fm1"</span><span class="token punctuation">:</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>postMessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>vMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true"> //I just think there is no need to use call() method
</span>     <span class="token comment" spellcheck="true"> //how about just oWorker.postMessage(vMsg);
</span>     <span class="token comment" spellcheck="true"> //the same situation with terminate
</span>     <span class="token comment" spellcheck="true"> //well,just a little faster,no search up the prototye chain
</span>      Worker<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>postMessage<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>oWorker<span class="token punctuation">,</span> vMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>terminate <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Worker<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>terminate<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>oWorker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>addListener <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>sName<span class="token punctuation">,</span> fListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oListeners<span class="token punctuation">[</span>sName<span class="token punctuation">]</span> <span class="token operator">=</span> fListener<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>removeListener <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>sName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> oListeners<span class="token punctuation">[</span>sName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true"> // your custom "queryable" worker
</span>  <span class="token keyword">var</span> oMyTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryableWorker</span><span class="token punctuation">(</span><span class="token string">"my_task.js"</span> <span class="token comment" spellcheck="true">/* , yourDefaultMessageListenerHere [optional], yourErrorListenerHere [optional] */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true"> // your custom "listeners"
</span>
  oMyTask<span class="token punctuation">.</span><span class="token function">addListener<span class="token punctuation">(</span></span><span class="token string">"printSomething"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>nResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span><span class="token string">"firstLink"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">appendChild<span class="token punctuation">(</span></span>document<span class="token punctuation">.</span><span class="token function">createTextNode<span class="token punctuation">(</span></span><span class="token string">" The difference is "</span> <span class="token operator">+</span> nResult <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  oMyTask<span class="token punctuation">.</span><span class="token function">addListener<span class="token punctuation">(</span></span><span class="token string">"alertSomething"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>nDeltaT<span class="token punctuation">,</span> sUnit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert<span class="token punctuation">(</span></span><span class="token string">"Worker waited for "</span> <span class="token operator">+</span> nDeltaT <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> sUnit <span class="token operator">+</span> <span class="token string">" :-)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstLink<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:oMyTask.sendQuery('getDifference', 5, 3);<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>What is the difference between 5 and 3?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:oMyTask.sendQuery('waitSomething');<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Wait 3 seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:oMyTask.terminate();<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>terminate() the Worker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div><div class="line-number" data-start="30" style="top: 551px;"></div><div class="line-number" data-start="31" style="top: 570px;"></div><div class="line-number" data-start="32" style="top: 589px;"></div><div class="line-number" data-start="33" style="top: 608px;"></div><div class="line-number" data-start="34" style="top: 627px;"></div><div class="line-number" data-start="35" style="top: 646px;"></div><div class="line-number" data-start="36" style="top: 665px;"></div><div class="line-number" data-start="37" style="top: 684px;"></div><div class="line-number" data-start="38" style="top: 703px;"></div><div class="line-number" data-start="39" style="top: 722px;"></div><div class="line-number" data-start="40" style="top: 741px;"></div><div class="line-number" data-start="41" style="top: 760px;"></div><div class="line-number" data-start="42" style="top: 779px;"></div><div class="line-number" data-start="43" style="top: 798px;"></div><div class="line-number" data-start="44" style="top: 817px;"></div><div class="line-number" data-start="45" style="top: 836px;"></div><div class="line-number" data-start="46" style="top: 855px;"></div><div class="line-number" data-start="47" style="top: 874px;"></div><div class="line-number" data-start="48" style="top: 893px;"></div><div class="line-number" data-start="49" style="top: 912px;"></div><div class="line-number" data-start="50" style="top: 931px;"></div><div class="line-number" data-start="51" style="top: 950px;"></div><div class="line-number" data-start="52" style="top: 969px;"></div><div class="line-number" data-start="53" style="top: 988px;"></div><div class="line-number" data-start="54" style="top: 1007px;"></div><div class="line-number" data-start="55" style="top: 1026px;"></div><div class="line-number" data-start="56" style="top: 1045px;"></div><div class="line-number" data-start="57" style="top: 1064px;"></div><div class="line-number" data-start="58" style="top: 1083px;"></div><div class="line-number" data-start="59" style="top: 1102px;"></div><div class="line-number" data-start="60" style="top: 1121px;"></div><div class="line-number" data-start="61" style="top: 1140px;"></div><div class="line-number" data-start="62" style="top: 1159px;"></div><div class="line-number" data-start="63" style="top: 1178px;"></div><div class="line-number" data-start="64" style="top: 1197px;"></div><div class="line-number" data-start="65" style="top: 1216px;"></div><div class="line-number" data-start="66" style="top: 1235px;"></div><div class="line-number" data-start="67" style="top: 1254px;"></div><div class="line-number" data-start="68" style="top: 1273px;"></div><div class="line-number" data-start="69" style="top: 1292px;"></div><div class="line-number" data-start="70" style="top: 1311px;"></div><div class="line-number" data-start="71" style="top: 1330px;"></div></code></pre>

<p><strong>my_task.js</strong> (the worker):</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token comment" spellcheck="true">// your custom PRIVATE functions
</span>
<span class="token keyword">function</span> myPrivateFunc1 <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // do something
</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> myPrivateFunc2 <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // do something
</span><span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">
// etc. etc.
</span><span class="token comment" spellcheck="true">
// your custom PUBLIC functions (i.e. queryable from the main page)
</span>
<span class="token keyword">var</span> queryableFunctions <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // example #1: get the difference between two numbers:
</span>  getDifference<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>nMinuend<span class="token punctuation">,</span> nSubtrahend<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reply<span class="token punctuation">(</span></span><span class="token string">"printSomething"</span><span class="token punctuation">,</span> nMinuend <span class="token operator">-</span> nSubtrahend<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token comment" spellcheck="true"> // example #2: wait three seconds
</span>  waitSomething<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">reply<span class="token punctuation">(</span></span><span class="token string">"alertSomething"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"seconds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// system functions
</span>
<span class="token keyword">function</span> defaultQuery <span class="token punctuation">(</span>vMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // your default PUBLIC function executed only when main page calls the queryableWorker.postMessage() method directly
</span> <span class="token comment" spellcheck="true"> // do something
</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> reply <span class="token punctuation">(</span><span class="token comment" spellcheck="true">/* listener name, argument to pass 1, argument to pass 2, etc. etc */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"reply - not enough arguments"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token punctuation">{</span> <span class="token string">"vo42t30"</span><span class="token punctuation">:</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"rnb93qh"</span><span class="token punctuation">:</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">.</span>data <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty<span class="token punctuation">(</span></span><span class="token string">"bk4e1h0"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty<span class="token punctuation">(</span></span><span class="token string">"ktp3fm1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    queryableFunctions<span class="token punctuation">[</span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bk4e1h0<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply<span class="token punctuation">(</span></span>self<span class="token punctuation">,</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ktp3fm1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">defaultQuery<span class="token punctuation">(</span></span>oEvent<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div><div class="line-number" data-start="30" style="top: 551px;"></div><div class="line-number" data-start="31" style="top: 570px;"></div><div class="line-number" data-start="32" style="top: 589px;"></div><div class="line-number" data-start="33" style="top: 608px;"></div><div class="line-number" data-start="34" style="top: 627px;"></div><div class="line-number" data-start="35" style="top: 646px;"></div><div class="line-number" data-start="36" style="top: 665px;"></div><div class="line-number" data-start="37" style="top: 684px;"></div><div class="line-number" data-start="38" style="top: 703px;"></div><div class="line-number" data-start="39" style="top: 722px;"></div><div class="line-number" data-start="40" style="top: 741px;"></div><div class="line-number" data-start="41" style="top: 760px;"></div><div class="line-number" data-start="42" style="top: 779px;"></div><div class="line-number" data-start="43" style="top: 798px;"></div><div class="line-number" data-start="44" style="top: 817px;"></div></code></pre>

<p>这是一个非常合适的方法，用于切换 主页-worker - 或是相反的 - 之间的消息。</p>

<h3 id=".E9.80.9A.E8.BF.87.E8.BD.AC.E8.AE.A9.E6.89.80.E6.9C.89.E6.9D.83(.E5.8F.AF.E8.BD.AC.E8.AE.A9.E5.AF.B9.E8.B1.A1).E6.9D.A5.E4.BC.A0.E9.80.92.E6.95.B0.E6.8D.AE">通过转让所有权(可转让对象)来传递数据</h3>

<p>Google Chrome 17 与 Firefox 18 包含另一种性能更高的方法来将特定类型的对象(<a class="external external-icon" href="http://dev.w3.org/html5/spec/common-dom-interfaces.html#transferable-objects">可转让对象</a>) 传递给一个 worker/从 worker 传回 。可转让对象从一个上下文转移到另一个上下文而不会经过任何拷贝操作。这意味着当传递大数据时会获得极大的性能提升。如果你从 C/C++ 世界来，那么把它想象成按照引用传递。然而与按照引用传递不同的是，一旦对象转让，那么它在原来上下文的那个版本将不复存在。该对象的所有权被转让到新的上下文内。例如，当你将一个&nbsp;<font face="'Courier New', 'Andale Mono', monospace"><span style="line-height: normal;"><a href="https://developer.mozilla.org/en/JavaScript_typed_arrays/ArrayBuffer" title="ArrayBuffer">ArrayBuffer </a>对象从主应用转让到</span></font>&nbsp;Worker 中，原始的 <code>ArrayBuffer</code>&nbsp;被清除并且无法使用。它包含的内容会(完整无差的)传递给 Worker 上下文。</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token comment" spellcheck="true">// Create a 32MB "file" and fill it.
</span><span class="token keyword">var</span> uInt8Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // 32MB
</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> uInt8Array <span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  uInt8Array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

worker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span>uInt8Array<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token punctuation">[</span>uInt8Array<span class="token punctuation">.</span>buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div></code></pre>

<p>要了解更多关于可转让对象的信息，<a class="external external-icon" href="http://updates.html5rocks.com/2011/12/Transferable-Objects-Lightning-Fast" title="http://updates.html5rocks.com/2011/12/Transferable-Objects-Lightning-Fast">请查看 HTML5Rocks</a>&nbsp;。</p>

<h2 id=".E7.94.9F.E6.88.90subworker">生成subworker</h2>

<p>如果需要的话 Worker 能够生成更多的 Worker。这样的被称为 subworker，它们必须托管在与父页面相同的源内。同理，subworker 解析 URI 时会相对于父 worker 的地址而不是自身的页面。这使得 worker 容易监控它们的依赖关系。</p>

<p>Chrome 目前并不支持subworker。参见&nbsp;<a class="external external-icon" href="http://code.google.com/p/chromium/issues/detail?id=31666" title="http://code.google.com/p/chromium/issues/detail?id=31666">crbug.com/31666</a>&nbsp;。</p>

<h2 id=".E5.B5.8C.E5.85.A5.E5.BC.8F_worker">嵌入式 worker</h2>

<p>目前没有一种「官方」的方法能够像&nbsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/script" title="HTML <script>&nbsp;元素的作用是在HTML或XHTML文档中嵌入或引用可执行的脚本。没有async或defer属性的脚本和内联脚本会在浏览器继续解析剩余文档前被获取并立刻执行。"><code>&lt;script&gt;</code></a> 元素一样将 worker 的代码嵌入的网页中。但是如果一个<span style="line-height: inherit;">&nbsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/script" title="HTML <script>&nbsp;元素的作用是在HTML或XHTML文档中嵌入或引用可执行的脚本。没有async或defer属性的脚本和内联脚本会在浏览器继续解析剩余文档前被获取并立刻执行。"><code>&lt;script&gt;</code></a> 元素</span><span style="line-height: inherit;">没有</span><span style="line-height: inherit;">&nbsp;</span><code style="font-size: 14px; line-height: inherit;">src 特性，并且它的</code><span style="line-height: inherit;">&nbsp;</span><code style="font-size: 14px; line-height: inherit;">type</code><span style="line-height: inherit;">&nbsp;特性没有指定成一个可运行的 mime-type，那么它就会被认为是一个数据块元素，并且能够被 JavaScript 使用。</span><span style="line-height: inherit;">「数据块</span><span style="line-height: inherit;">」是 HTML5 中一个十分常见的特性，它可以携带几乎任何文本类型的数据。所以，你能够以</span><span style="line-height: inherit;">如下方式嵌入一个 worker：</span></p>

<pre class="brush: html  language-html" data-number=""><code class=" language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>MDN Example - Embedded worker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/js-worker<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token comment" spellcheck="true"> // 该脚本不会被 JS 引擎解析，因为它的 mime-type 是 text/js-worker。
</span>  <span class="token keyword">var</span> myVar <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true"> // 剩下的 worker 代码写到这里。
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token comment" spellcheck="true"> // 该脚本会被 JS 引擎解析，因为它的 mime-type 是 text/javascript。
</span>  <span class="token keyword">function</span> pageLog <span class="token punctuation">(</span>sMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // 使用 fragment：这样浏览器只会进行一次渲染/重排。
</span>    <span class="token keyword">var</span> oFragm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oFragm<span class="token punctuation">.</span><span class="token function">appendChild<span class="token punctuation">(</span></span>document<span class="token punctuation">.</span><span class="token function">createTextNode<span class="token punctuation">(</span></span>sMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oFragm<span class="token punctuation">.</span><span class="token function">appendChild<span class="token punctuation">(</span></span>document<span class="token punctuation">.</span><span class="token function">createElement<span class="token punctuation">(</span></span><span class="token string">"br"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector<span class="token punctuation">(</span></span><span class="token string">"#logDisplay"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild<span class="token punctuation">(</span></span>oFragm<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/js-worker<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token comment" spellcheck="true"> // 该脚本不会被 JS 引擎解析，因为它的 mime-type 是 text/js-worker。
</span>  onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">postMessage<span class="token punctuation">(</span></span>myVar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true"> // 剩下的 worker 代码写到这里。
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token comment" spellcheck="true"> // 该脚本会被 JS 引擎解析，因为它的 mime-type 是 text/javascript。
</span>
 <span class="token comment" spellcheck="true"> // 在过去...：
</span> <span class="token comment" spellcheck="true"> // 我们使用 blob builder
</span> <span class="token comment" spellcheck="true"> // ...但是现在我们使用 Blob...:
</span>  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll<span class="token punctuation">(</span></span><span class="token string">"script[type=\"text\/js-worker\"]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oScript<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> oScript<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">"text/javascript"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true"> // 创建一个新的 document.worker 属性，包含所有 "text/js-worker" 脚本。
</span>  document<span class="token punctuation">.</span>worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL<span class="token punctuation">(</span></span>blob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pageLog<span class="token punctuation">(</span></span><span class="token string">"Received: "</span> <span class="token operator">+</span> oEvent<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true"> // 启动 worker.
</span>  window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logDisplay<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div><div class="line-number" data-start="30" style="top: 551px;"></div><div class="line-number" data-start="31" style="top: 570px;"></div><div class="line-number" data-start="32" style="top: 589px;"></div><div class="line-number" data-start="33" style="top: 608px;"></div><div class="line-number" data-start="34" style="top: 627px;"></div><div class="line-number" data-start="35" style="top: 646px;"></div><div class="line-number" data-start="36" style="top: 665px;"></div><div class="line-number" data-start="37" style="top: 684px;"></div><div class="line-number" data-start="38" style="top: 703px;"></div><div class="line-number" data-start="39" style="top: 722px;"></div><div class="line-number" data-start="40" style="top: 741px;"></div><div class="line-number" data-start="41" style="top: 760px;"></div><div class="line-number" data-start="42" style="top: 779px;"></div><div class="line-number" data-start="43" style="top: 798px;"></div><div class="line-number" data-start="44" style="top: 817px;"></div><div class="line-number" data-start="45" style="top: 836px;"></div><div class="line-number" data-start="46" style="top: 855px;"></div><div class="line-number" data-start="47" style="top: 874px;"></div><div class="line-number" data-start="48" style="top: 893px;"></div></code></pre>

<p>现在，嵌入式 worker 已经嵌套进了一个自定义的&nbsp;<code>document.worker</code>&nbsp;属性中。</p>

<h2 id=".E8.B6.85.E6.97.B6.E4.B8.8E.E9.97.B4.E9.9A.94">超时与间隔</h2>

<p>Worker 能够像主线程一样使用超时与间隔。这会十分有用，比如说，如果你想让 worker 线程周期性而并非不间断的运行代码。</p>

<p>查看&nbsp;<a class="internal" href="https://developer.mozilla.org/en/DOM/window.setTimeout" title="En/DOM/Window.setTimeout"><code>setTimeout()</code></a>，&nbsp;<code><a class="internal" href="https://developer.mozilla.org/en/DOM/window.clearTimeout" title="En/DOM/Window.clearTimeout">clearTimeout()</a>，</code>&nbsp;<code><a class="internal" href="https://developer.mozilla.org/en/DOM/window.setInterval" title="En/DOM/Window.setInterval">setInterval()</a>，</code>&nbsp;与&nbsp;<a class="internal" href="https://developer.mozilla.org/en/DOM/window.clearInterval" title="En/DOM/Window.clearInterval"><code>clearInterval()</code> </a>了解详情。还可以查看：&nbsp;<a href="https://developer.mozilla.org/en-US/docs/JavaScript/Timers" title="/en-US/docs/JavaScript/Timers">JavaScript 定时器</a>。</p>

<h2 id=".E7.BB.88.E6.AD.A2_worker">终止 worker</h2>

<p>如果你想立即终止一个运行中的 worker，可以调用 worker 的&nbsp;<code>terminate()方法：</code></p>

<pre class="syntaxbox">myWorker.terminate();</pre>

<p>worker 线程会被立即杀死，不会留下任何机会让它完成自己的操作或清理工作。</p>

<p>Workers 也可以调用自己的 <code><a class="new" href="https://developer.mozilla.org/zh-CN/docs/XPCOM_Interface_Reference/nsIWorkerScope#close()">nsIWorkerScope.close()</a></code> 方法来关闭自己：</p>

<pre class="syntaxbox">self.close();</pre>

<h2 id=".E5.A4.84.E7.90.86.E9.94.99.E8.AF.AF">处理错误</h2>

<p>当 worker 出现运行时错误时，它的&nbsp;<code>onerror</code>&nbsp;事件处理函数会被调用。它会收到一个<span style="line-height: inherit;">实现了&nbsp;</span><code style="font-size: 14px; line-height: inherit;">ErrorEvent</code><span style="line-height: inherit;">&nbsp;接口</span><span style="line-height: inherit;">名为</span><span style="line-height: inherit;">&nbsp;</span><code style="font-size: 14px; line-height: inherit;">error</code><span style="line-height: inherit;">的事件。该事件不会冒泡，并且可以被取消；为了防止触发默认动作，</span><span style="line-height: inherit;">worker 可以调用错误事件的&nbsp;</span><code style="line-height: inherit;"><a class="internal" href="https://developer.mozilla.org/en/DOM/event.preventDefault" style="line-height: inherit;" title="En/DOM/Event.preventDefault">preventDefault()</a>&nbsp;方法。</code></p>

<p>错误事件拥有下列三个它感兴趣的字段：</p>

<dl>
 <dt><code>message</code></dt>
 <dd>可读性良好的错误消息。</dd>
 <dt><code>filename</code></dt>
 <dd>发生错误的脚本文件名。</dd>
 <dt><code>lineno</code></dt>
 <dd>发生错误时所在脚本文件的行号。</dd>
</dl>

<h2 id=".E8.AE.BF.E9.97.AE_navigator_.E5.AF.B9.E8.B1.A1">访问 navigator 对象</h2>

<p>Workers 可以在它的作用域内访问&nbsp;<code>navigator</code>&nbsp;对象。它含有如下能够识别浏览器的字符串，就像在普通脚本中做的那样：</p>

<ul>
 <li><code>appName</code></li>
 <li><code>appVersion</code></li>
 <li><code>platform</code></li>
 <li><code>userAgent</code></li>
</ul>

<h2 id=".E5.BC.95.E5.85.A5.E8.84.9A.E6.9C.AC.E4.B8.8E.E5.BA.93">引入脚本与库</h2>

<p>Worker 线程能够访问一个全局函数，<code>importScripts()</code>&nbsp;，该函数允许 worker 将脚本或库引入自己的作用域内。你可以不传入参数，或传入多个脚本的 URI 来引入；以下的例子都是合法的：</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token function">importScripts<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">/* 什么都不引入 */</span>
<span class="token function">importScripts<span class="token punctuation">(</span></span><span class="token string">'foo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">/* 只引入 "foo.js" */</span>
<span class="token function">importScripts<span class="token punctuation">(</span></span><span class="token string">'foo.js'</span><span class="token punctuation">,</span> <span class="token string">'bar.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">/* 引入两个脚本 */</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div></code></pre>

<p>浏览器将列出的脚本加载并运行。每个脚本中的全局对象都能够被 worker 使用。如果脚本无法加载，将抛出&nbsp;<code>NETWORK_ERROR</code>&nbsp;异常，接下来的代码也无法执行。而之前执行的代码(包括使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setTimeout" title="在指定的延迟时间之后调用一个函数或执行一个代码片段."><code>window.setTimeout()</code></a> 延迟执行的代码)却依然能够使用。<code>importScripts()</code><span style="line-height: inherit;">&nbsp;</span><strong style="line-height: inherit;">之后</strong><span style="line-height: inherit;">的函数声明依然能够使用，因为它们始终会在其他代码之前运行。</span></p>

<div class="note"><strong>注意：</strong>&nbsp;脚本的下载顺序不固定，但执行时会按照你将文件名传入到&nbsp;<code>importScripts()</code>&nbsp;中的顺序。这是同步完成的；直到所有脚本都下载并运行完毕，&nbsp;<code>importScripts()</code>&nbsp;才会返回。</div>

<h2 id=".E4.BE.8B.E5.AD.90">例子</h2>

<p>本节提供了几个如何使用 DOM worker 的例子。</p>

<h3 id=".E5.9C.A8.E5.90.8E.E5.8F.B0.E6.89.A7.E8.A1.8C.E8.BF.90.E7.AE.97">在后台执行运算</h3>

<p>worker 的一个优势在于能够执行处理器密集型的运算而不会阻塞 UI 线程。在下面的例子中，worker 用于计算斐波那契数。</p>

<h4 id="JavaScript_.E4.BB.A3.E7.A0.81">JavaScript 代码</h4>

<p>下面的 JavaScript 代码保存在「fibonacci.js」文件中，与下一节的 HTML 文件关联。</p>

<pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resultReceiver<span class="token punctuation">(</span></span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  results<span class="token punctuation">.</span><span class="token function">push<span class="token punctuation">(</span></span><span class="token function">parseInt<span class="token punctuation">(</span></span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">postMessage<span class="token punctuation">(</span></span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">errorReceiver<span class="token punctuation">(</span></span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

onmessage <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">parseInt<span class="token punctuation">(</span></span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">postMessage<span class="token punctuation">(</span></span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"fibonacci.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> resultReceiver<span class="token punctuation">;</span>
    worker<span class="token punctuation">.</span>onerror <span class="token operator">=</span> errorReceiver<span class="token punctuation">;</span>
    worker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span>n <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div></code></pre>

<p>worker 将属性&nbsp;<code>onmessage</code>&nbsp;设置为一个函数，当 worker 对象调用&nbsp;<code>postMessage() 时该函数会接收到发送过来的信息。</code>(注意，这么使用并不等同于定义一个同名的全局<em>变量</em>&nbsp;，或是定义一个同名的<em>函数</em>。<code>var onmessage</code>&nbsp;与&nbsp;<code>function onmessage</code>&nbsp;将会定义与该名字相同的全局属性，但是它们不会注册能够接收从创建 worker 的网页发送过来的消息的函数。) 这会启用递归，生成自己的新拷贝来处理计算的每一个循环。</p>

<h4 id="HTML_.E4.BB.A3.E7.A0.81">HTML 代码</h4>

<pre class="brush: html  language-html" data-number=""><code class=" language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span>  <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Test threads fibonacci<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"fibonacci.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span><span class="token string">"result"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token function">dump<span class="token punctuation">(</span></span><span class="token string">"Got: "</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    worker<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dump<span class="token punctuation">(</span></span><span class="token string">"Worker error: "</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    worker<span class="token punctuation">.</span><span class="token function">postMessage<span class="token punctuation">(</span></span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div></code></pre>

<p>网页创建了一个&nbsp;<code>div</code>&nbsp;元素，ID 为&nbsp;<code>result</code>&nbsp;， 用它来显示运算结果，然后生成 worker。在生成 worker 后，<code>onmessage</code>&nbsp;处理函数配置为通过设置&nbsp;<code>div</code>&nbsp;元素的内容来显示运算结果，然后&nbsp;<code>onerror</code>&nbsp;处理函数被设置为&nbsp;<a class="external external-icon" href="https://developer.mozilla.org/en/Debugging_JavaScript#dump()" title="https://developer.mozilla.org/editor/fckeditor/core/editor/en/Debugging_JavaScript#dump()">转储</a>&nbsp;错误信息。</p>

<p>最后，向 worker 发送一条信息来启动它。</p>

<p><a class="external external-icon" href="https://developer.mozilla.org/samples/workers/fibonacci" title="https://developer.mozilla.org/samples/workers/fibonacci/">运行这个例子</a>。</p>

<h3 id=".E5.9C.A8.E5.90.8E.E5.8F.B0.E8.BF.90.E8.A1.8C_web_I.2FO">在后台运行 web I/O</h3>

<p>你可以在&nbsp;<a class="internal" href="https://developer.mozilla.org/En/Using_workers_in_extensions" title="En/Using workers in extensions">在扩展中使用 worker</a>&nbsp;这篇文章中找到相关例子。</p>

<h3 id=".E5.88.92.E5.88.86.E4.BB.BB.E5.8A.A1.E7.BB.99.E5.A4.9A.E4.B8.AA_worker">划分任务给多个 worker</h3>

<p>当多核系统流行开来，将复杂的运算任务分配给多个 worker 来运行已经变得十分有用，这些 worker 会在多处理器内核上运行这些任务。</p>

<p>例子马上就来</p>

<h3 id=".E5.9C.A8_worker_.E5.86.85.E5.88.9B.E5.BB.BA_worker">在 worker 内创建 worker</h3>

<p>前面斐波那契那个例子已经证明了事实上 worker 能够<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#Spawning_subworkers">生成额外的 workers</a>。这使得创建递归程序越发的简单了。</p>

<h2 id="Browser_Compatibility" name="Browser_Compatibility">浏览器兼容性</h2>

<p></p><div class="htab"> 
    <a id="AutoCompatibilityTable" name="AutoCompatibilityTable"></a> 
    <ul> 
        <li class="selected"><a>Desktop</a></li> 
        <li><a>Mobile</a></li> 
    </ul> 
<div id="compat-desktop" style="display: block;">
<table class="compat-table">
 <tbody>
  <tr>
   <th>Feature</th>
   <th>Chrome</th>
   <th>Firefox (Gecko)</th>
   <th>Internet Explorer</th>
   <th>Opera</th>
   <th>Safari (WebKit)</th>
  </tr>
  <tr>
   <td>Dedicated workers</td>
   <td>3</td>
   <td>3.5 (1.9.1)</td>
   <td>10</td>
   <td>10.60</td>
   <td>4</td>
  </tr>
  <tr>
   <td>Shared workers</td>
   <td>5</td>
   <td>---</td>
   <td>---</td>
   <td>10.60</td>
   <td>5</td>
  </tr>
  <tr>
   <td>Passing data using <a href="https://developer.mozilla.org/en/DOM/The_structured_clone_algorithm" title="The structured clone algorithm">structured cloning</a> .&nbsp;</td>
   <td>13</td>
   <td>8</td>
   <td>10</td>
   <td>11.50</td>
   <td>5.1</td>
  </tr>
  <tr>
   <td>Passing data using&nbsp; <a class="external external-icon" href="http://dev.w3.org/html5/spec/common-dom-interfaces.html#transferable-objects" title="http://dev.w3.org/html5/spec/common-dom-interfaces.html#transferable-objects">transferable objects</a></td>
   <td>17 <span class="inlineIndicator prefixBox prefixBoxInline" title="prefix"><a class="new" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/zh-CN/docs/Web/Guide/Prefixes" title="The name of this feature is prefixed with 'webkit' as this browser considers it experimental">webkit</a></span></td>
   <td>18</td>
   <td>---</td>
   <td>---</td>
   <td>---</td>
  </tr>
 </tbody>
</table>
</div><div id="compat-mobile" style="display: none;">
<table class="compat-table">
 <tbody>
  <tr>
   <th>Feature</th>
   <th>Android</th>
   <th>Chrome for Android</th>
   <th>Firefox Mobile (Gecko)</th>
   <th>IE&nbsp;Phone</th>
   <th>Opera Mobile</th>
   <th>Safari Mobile</th>
  </tr>
  <tr>
   <td>Dedicated workers</td>
   <td>---</td>
   <td>0.16</td>
   <td>3.5 (1.9.1)</td>
   <td>---</td>
   <td>11</td>
   <td>5</td>
  </tr>
  <tr>
   <td>Shared workers</td>
   <td>---</td>
   <td><span style="color: #f00;">未实现</span></td>
   <td>---</td>
   <td>---</td>
   <td>---</td>
   <td>---</td>
  </tr>
  <tr>
   <td>Passing data using <a href="https://developer.mozilla.org/en/DOM/The_structured_clone_algorithm" title="The structured clone algorithm">structured cloning</a> .&nbsp;</td>
   <td>---</td>
   <td>0.16</td>
   <td>8</td>
   <td>---</td>
   <td>---</td>
   <td>---</td>
  </tr>
  <tr>
   <td>Passing data using&nbsp; <a class="external external-icon" href="http://dev.w3.org/html5/spec/common-dom-interfaces.html#transferable-objects" title="http://dev.w3.org/html5/spec/common-dom-interfaces.html#transferable-objects">transferable objects</a></td>
   <td>---</td>
   <td>&nbsp;</td>
   <td>18</td>
   <td>---</td>
   <td>---</td>
   <td>---</td>
  </tr>
 </tbody>
</table>
</div></div><p></p>





<h2 id="See_also">See also</h2>

<ul>
 <li><a class="external external-icon" href="http://dev.w3.org/html5/workers/">File API Specification: Web Workers</a><span style="color: #fff; background: #e61919; display: inline-block; font-size: x-small; margin-left: 6px; white-space: nowrap; padding: 2px 5px;" title="编辑草案(非官方)">ED</span></li>
 <li><code><a class="internal" href="https://developer.mozilla.org/en/DOM/Worker" title="En/DOM/Worker">Worker</a></code> interface</li>
 <li><code><a class="internal" href="https://developer.mozilla.org/en/DOM/SharedWorker" title="En/DOM/SharedWorker">SharedWorker</a></code> interface</li>
 <li><a href="https://developer.mozilla.org/en/DOM/Worker/Functions_available_to_workers" title="En/DOM/Worker/Functions available to workers">Functions available to workers</a></li>
 <li><a class="external external-icon" href="http://www.html5rocks.com/en/tutorials/workers/basics/#toc-enviornment-subworkers" title="http://www.html5rocks.com/en/tutorials/workers/basics/#toc-enviornment-subworkers">HTML5Rocks - The Basics of Web Workers</a></li>
 <li><code><a class="external external-icon" href="http://code.google.com/p/chromium/issues/detail?id=127990" title="Chrome has Problems with many workers">Chrome has problems when using too many workers</a></code></li>
</ul>

<p></p><div class="horizFlexboxContainer"> 
  <div class="smallTextMultiColumnBoxHeading">HTML5 Documentation</div> 
  <div class="smallTextMultiColumnBoxList"> 
<table class="html5ArticleToc"> 
	<tbody> 
		<tr> 
			<td style="width: 150px; border-left: none; border-right: none; border-top: none; border-bottom: dotted 2px rgba(224,244,244,200);"><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#HTML" title="HTML5 Documentation">HTML</a></td> 
			<td style="border-left: none; border-right: none; border-top: none; border-bottom: dotted 2px rgba(224,244,244,200);"> 
				<ul> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/Using_HTML5_audio_and_video" title="Using HTML5 audio and video">Audio/Video</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/Canvas" title="Canvas">Canvas</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/WebGL" title="WebGL">WebGL</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/SVG" title="SVG">SVG</a></li> 
					<li><a class="new" href="https://developer.mozilla.org/zh-CN/docs/MathML" title="MathML">MathML</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#WebForms" title="HTML5 Thematic Classification #WebForms">WebForms</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/Using_the_application_cache" title="Using Application Cache">AppCache</a></li> 
					<li><a class="new" href="https://developer.mozilla.org/zh-CN/docs/Using_microformats" title="Using microformats">Microformats</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#Semantic_tags" title="HTML5 Thematic Classification#Semantic tags">SemanticTags</a></li> 
				</ul> 
			</td> 
		</tr> 
		<tr> 
			<td style="width: 150px; border-left: none; border-right: none; border-top: none; border-bottom: dotted 2px rgba(224,244,244,200);"><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#JavaScript" title="HTML5 Thematic Classification #JavaScript">JavaScript</a></td> 
			<td style="border-left: none; border-right: none; border-top: none; border-bottom: dotted 2px rgba(224,244,244,200);"> 
				<ul> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#Client-Side_Storage" title="HTML5 Thematic Classification #Client-Side Storage">Storage</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#IndexedDB" title="HTML5 Thematic Classification #IndexedDB">IndexedDB</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/WebSockets" title="WebSockets">WebSockets</a></li> 
					<li><a class="new" href="https://developer.mozilla.org/zh-CN/docs/Using_web_workers" title="Using web workers">WebWorkers</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/Online_and_offline_events" title="Online and offline events">Events</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/DragDrop/Drag_and_Drop" title="Drag and Drop">Drag/Drop</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/Web-based_protocol_handlers" title="Web-based protocol handlers">ProtocolHandler</a></li> 
					<li><a class="new" href="https://developer.mozilla.org/zh-CN/docs/Using_geolocation" title="Using geolocation">Geolocation</a></li> 
					<li><a class="new" href="https://developer.mozilla.org/zh-CN/docs/Focus_management_in_HTML" title="Focus management in HTML">Focus</a></li> 
				</ul> 
			</td> 
		</tr> 
		<tr> 
			<td style="border: none;"><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#CSS" title="HTML5 Thematic Classification #CSS">CSS</a></td> 
			<td style="border: none;"> 
				<ul> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla_CSS_support_chart" title="Mozilla CSS support chart">NewSelectors</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#Typography" title="HTML5 Thematic Classification #Typography">Typography</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#Visual" title="HTML5 Thematic Classification #Visual">Visual</a></li> 
					<li><a href="https://developer.mozilla.org/zh-CN/docs/HTML/HTML5/HTML5_Thematic_Classification#Effects" title="HTML5 Thematic Classification #Effects">Effects</a></li> 
				</ul> 
			</td> 
		</tr> 
	</tbody> 
</table> 
</div> 
</div><p></p>

<p></p>
                                                </article>

            

              
                <!-- contributors -->
                <div class="wiki-block contributors">
                  <h2 class="offscreen">文档标签和贡献者</h2>
                                    
                                      <div class="contributors-sub"> <i aria-hidden="true" class="icon-group"></i><strong>向此页面作出贡献：</strong>         <a href="https://developer.mozilla.org/zh-CN/profiles/ziyunfei">ziyunfei</a>,             <a href="https://developer.mozilla.org/zh-CN/profiles/fscholz">fscholz</a>,             <a href="https://developer.mozilla.org/zh-CN/profiles/siberiawolf0307">siberiawolf0307</a>,             <a href="https://developer.mozilla.org/zh-CN/profiles/sunnylost">sunnylost</a>,             <a href="https://developer.mozilla.org/zh-CN/profiles/xcffl">xcffl</a>     </div>                  
                                      <div class="contributors-sub">
                      <i aria-hidden="true" class="icon-clock-o"></i><strong>最后编辑者:</strong>
                      <a href="https://developer.mozilla.org/zh-CN/profiles/fscholz">fscholz</a>,
                      <time datetime="2015-04-17T15:00:39-07:00">Apr 17, 2015, 3:00:39 PM</time>
                    </div>
                                  </div>
                          </div>

                      </div>
        </div>
      </div>
    </div> <!-- ends "main-content" -->

  <menu type="context" id="edit-history-menu">
    <menuitem data-action="/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers$edit" label="编辑页面"></menuitem>
    <menuitem data-action="/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers$history" label="查看页面历史"></menuitem>
  </menu>
  </div></main>

  <!-- Footer -->
  <footer><div class="center">
    <div class="column-container">
      <div class="column-main">
                <p>
          <bdi>© 2005-2015 Mozilla 开发者网络和各贡献者<br> 内容可根据<a href="https://developer.mozilla.org/en-US/docs/MDN/About#Copyrights_and_licenses">此协议</a>使用 · <a href="https://developer.mozilla.org/docs/MDN/About">关于 MDN</a> · <a href="https://www.mozilla.org/about/legal/terms/mozilla">条款</a> · <a href="https://www.mozilla.org/privacy/websites/">隐私</a> · <a href="https://www.mozilla.org/privacy/websites/#cookies">Cookie</a> · <a href="https://github.com/mozilla/kuma">贡献代码</a></bdi>        </p>
              </div>
      <div class="column-strip">
                        <form class="languages go" method="get" action="https://developer.mozilla.org/zh-CN/docs/Web">
      <label for="language">其他语言：</label>
      <select id="language" class="wiki-l10n" name="next" dir="ltr">
        <option value="/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" selected="">
          中文 (简体)
        </option>
                  <option value="/fr/docs/Utilisation_des_web_workers">
            Français
          </option>          <option value="/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">
            English (US)
          </option>          <option value="/ja/docs/Web/Guide/Performance/Using_web_workers">
            日本語
          </option>          <option value="/nl/docs/Gebruik_maken_van_DOM_workers">
            Nederlands
          </option>          <option value="/ru/docs/DOM/Using_web_workers">
            Русский
          </option>          <option value="/zh-TW/docs/Web/Guide/Performance/Using_web_workers">
            正體中文 (繁體)
          </option>          <option value="/es/docs/Web/Guide/Performance/Usando_web_workers">
            Español
          </option>          <option value="/pl/docs/Web/Guide/Performance/Uzycie_web_workers">
            Polski
          </option>          <option value="/ko/docs/Web/API/Web_Workers_API/basic_usage">
            한국어
          </option>      </select>
      
    </form>
                </div>
    </div>
  </div></footer>

  <!-- site js -->
    
  
      <!--[if lte IE 8]><script src="/media/js/libs/selectivizr-1.0.2/selectivizr-build.js"></script><![endif]-->

    
<form id="_persona_login" method="post" action="https://developer.mozilla.org/users/persona/signin" data-csrf-token-url="/users/persona/csrf" data-request="{&quot;siteName&quot;: &quot;Mozilla Developer Network&quot;, &quot;siteLogo&quot;: &quot;/media/img/opengraph-logo.png&quot;}">
  <input type="hidden" name="csrfmiddlewaretoken" value="" id="_persona_csrf_token">
  <input type="hidden" name="next" value="" id="_persona_next_url">
  <input type="hidden" name="process" value="" id="_persona_process">
  <input type="hidden" name="assertion" id="_persona_assertion">
</form>

    

      

    

          
      
    
    
</body></html>